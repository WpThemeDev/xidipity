!function(){"use strict";var t,e,n,r,o,i,a=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=function(t){return function(){return t}},c=u(!1),l=u(!0),M={noop:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},noarg:function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n()}},compose:function(n,r){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n(r.apply(null,arguments))}},constant:u,identity:function(t){return t},tripleEquals:function(t,e){return t===e},curry:function(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];for(var a=new Array(arguments.length-1),n=1;n<arguments.length;n++)a[n-1]=arguments[n];return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];var o=a.concat(n);return i.apply(null,o)}},not:function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!n.apply(null,arguments)}},die:function(t){return function(){throw new Error(t)}},apply:function(t){return t()},call:function(t){t()},never:c,always:l},s=M.never,f=M.always,d=function(){return m},m=(r={fold:function(t,e){return t()},is:s,isSome:s,isNone:f,getOr:n=function(t){return t},getOrThunk:e=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},or:n,orThunk:e,map:d,ap:d,each:function(){},bind:d,flatten:d,exists:s,forall:f,filter:d,equals:t=function(t){return t.isNone()},equals_:t,toArray:function(){return[]},toString:M.constant("none()")},Object.freeze&&Object.freeze(r),r),g=function(n){var t=function(){return n},e=function(){return o},r=function(t){return t(n)},o={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:f,isNone:s,getOr:t,getOrThunk:t,getOrDie:t,or:e,orThunk:e,map:function(t){return g(t(n))},ap:function(t){return t.fold(d,function(t){return g(t(n))})},each:function(t){t(n)},bind:r,flatten:t,exists:r,forall:r,filter:function(t){return t(n)?o:m},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(s,function(t){return e(n,t)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},W={some:g,none:d,from:function(t){return null==t?m:g(t)}},p=function(e){return function(t){return function(t){if(null===t)return"null";var e=typeof t;return"object"===e&&Array.prototype.isPrototypeOf(t)?"array":"object"===e&&String.prototype.isPrototypeOf(t)?"string":e}(t)===e}},j={isString:p("string"),isObject:p("object"),isArray:p("array"),isNull:p("null"),isBoolean:p("boolean"),isUndefined:p("undefined"),isFunction:p("function"),isNumber:p("number")},h=void 0===(o=Array.prototype.indexOf)?function(t,e){return R(t,e)}:function(t,e){return o.call(t,e)},v=function(t,e){return-1<h(t,e)},b=function(t,e){for(var n=t.length,r=new Array(n),o=0;o<n;o++){var i=t[o];r[o]=e(i,o,t)}return r},w=function(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n,t)},y=function(t,e){for(var n=t.length-1;0<=n;n--)e(t[n],n,t)},x=function(t,e){for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];e(i,r,t)&&n.push(i)}return n},C=function(t,e){for(var n=0,r=t.length;n<r;n++)if(e(t[n],n,t))return W.some(n);return W.none()},R=function(t,e){for(var n=0,r=t.length;n<r;++n)if(t[n]===e)return n;return-1},S=Array.prototype.push,T=function(t){for(var e=[],n=0,r=t.length;n<r;++n){if(!Array.prototype.isPrototypeOf(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);S.apply(e,t[n])}return e},D=function(t,e){for(var n=0,r=t.length;n<r;++n)if(!0!==e(t[n],n,t))return!1;return!0},k=Array.prototype.slice,A=j.isFunction(Array.from)?Array.from:function(t){return k.call(t)},q={map:b,each:w,eachr:y,partition:function(t,e){for(var n=[],r=[],o=0,i=t.length;o<i;o++){var a=t[o];(e(a,o,t)?n:r).push(a)}return{pass:n,fail:r}},filter:x,groupBy:function(t,e){if(0===t.length)return[];for(var n=e(t[0]),r=[],o=[],i=0,a=t.length;i<a;i++){var u=t[i],c=e(u);c!==n&&(r.push(o),o=[]),n=c,o.push(u)}return 0!==o.length&&r.push(o),r},indexOf:function(t,e){var n=h(t,e);return-1===n?W.none():W.some(n)},foldr:function(t,e,n){return y(t,function(t){n=e(n,t)}),n},foldl:function(t,e,n){return w(t,function(t){n=e(n,t)}),n},find:function(t,e){for(var n=0,r=t.length;n<r;n++){var o=t[n];if(e(o,n,t))return W.some(o)}return W.none()},findIndex:C,flatten:T,bind:function(t,e){var n=b(t,e);return T(n)},forall:D,exists:function(t,e){return C(t,e).isSome()},contains:v,equal:function(t,n){return t.length===n.length&&D(t,function(t,e){return t===n[e]})},reverse:function(t){var e=k.call(t,0);return e.reverse(),e},chunk:function(t,e){for(var n=[],r=0;r<t.length;r+=e){var o=t.slice(r,r+e);n.push(o)}return n},difference:function(t,e){return x(t,function(t){return!v(e,t)})},mapToObject:function(t,e){for(var n={},r=0,o=t.length;r<o;r++){var i=t[r];n[String(i)]=e(i,r)}return n},pure:function(t){return[t]},sort:function(t,e){var n=k.call(t,0);return n.sort(e),n},range:function(t,e){for(var n=[],r=0;r<t;r++)n.push(e(r));return n},head:function(t){return 0===t.length?W.none():W.some(t[0])},last:function(t){return 0===t.length?W.none():W.some(t[t.length-1])},from:A},N=void 0===(i=Object.keys)?function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}:i,O=function(t,e){for(var n=N(t),r=0,o=n.length;r<o;r++){var i=n[r];e(t[i],i,t)}},I=function(r,o){var i={};return O(r,function(t,e){var n=o(t,e,r);i[n.k]=n.v}),i},P=function(t,n){var r=[];return O(t,function(t,e){r.push(n(t,e))}),r},B=function(t){return P(t,function(t){return t})},E={bifilter:function(t,n){var r={},o={};return O(t,function(t,e){(n(t,e)?r:o)[e]=t}),{t:r,f:o}},each:O,map:function(t,r){return I(t,function(t,e,n){return{k:e,v:r(t,e,n)}})},mapToArray:P,tupleMap:I,find:function(t,e){for(var n=N(t),r=0,o=n.length;r<o;r++){var i=n[r],a=t[i];if(e(a,i,t))return W.some(a)}return W.none()},keys:N,values:B,size:function(t){return B(t).length}},H=function(t){return t.slice(0).sort()},L=function(t,e){throw new Error("All required keys ("+H(t).join(", ")+") were not specified. Specified keys were: "+H(e).join(", ")+".")},z=function(t){throw new Error("Unsupported keys for object: "+H(t).join(", "))},_=function(e,t){if(!j.isArray(t))throw new Error("The "+e+" fields must be an array. Was: "+t+".");q.each(t,function(t){if(!j.isString(t))throw new Error("The value "+t+" in the "+e+" fields was not a string.")})},F=function(t){var n=H(t);q.find(n,function(t,e){return e<n.length-1&&t===n[e+1]}).each(function(t){throw new Error("The field: "+t+" occurs more than once in the combined fields: ["+n.join(", ")+"].")})},V={immutable:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if(e.length!==n.length)throw new Error('Wrong number of arguments to struct. Expected "['+e.length+']", got '+n.length+" arguments");var r={};return q.each(e,function(t,e){r[t]=M.constant(n[e])}),r}},immutableBag:function(o,i){var a=o.concat(i);if(0===a.length)throw new Error("You must specify at least one required or optional field.");return _("required",o),_("optional",i),F(a),function(e){var n=E.keys(e);q.forall(o,function(t){return q.contains(n,t)})||L(o,n);var t=q.filter(n,function(t){return!q.contains(a,t)});0<t.length&&z(t);var r={};return q.each(o,function(t){r[t]=M.constant(e[t])}),q.each(i,function(t){r[t]=M.constant(Object.prototype.hasOwnProperty.call(e,t)?W.some(e[t]):W.none())}),r}}},U=V.immutable("width","height"),G=V.immutable("rows","columns"),Y=V.immutable("row","column"),J=V.immutable("x","y"),X=V.immutable("element","rowspan","colspan"),K=V.immutable("element","rowspan","colspan","isNew"),Z={dimensions:U,grid:G,address:Y,coords:J,extended:V.immutable("element","rowspan","colspan","row","column"),detail:X,detailnew:K,rowdata:V.immutable("element","cells","section"),elementnew:V.immutable("element","isNew"),rowdatanew:V.immutable("element","cells","section","isNew"),rowcells:V.immutable("cells","section"),rowdetails:V.immutable("details","section"),bounds:V.immutable("startRow","startCol","finishRow","finishCol")},$=function(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:M.constant(t)}},Q={fromHtml:function(t,e){var n=(e||document).createElement("div");if(n.innerHTML=t,!n.hasChildNodes()||1<n.childNodes.length)throw console.error("HTML does not have a single root node",t),"HTML must have a single root node";return $(n.childNodes[0])},fromTag:function(t,e){var n=(e||document).createElement(t);return $(n)},fromText:function(t,e){var n=(e||document).createTextNode(t);return $(n)},fromDom:$,fromPoint:function(t,e,n){return W.from(t.dom().elementFromPoint(e,n)).map($)}},tt=function(t){return 1!==t.nodeType&&9!==t.nodeType||0===t.childElementCount},et={all:function(t,e){var n=void 0===e?document:e.dom();return tt(n)?[]:q.map(n.querySelectorAll(t),Q.fromDom)},is:function(t,e){var n=t.dom();if(1!==n.nodeType)return!1;if(void 0!==n.matches)return n.matches(e);if(void 0!==n.msMatchesSelector)return n.msMatchesSelector(e);if(void 0!==n.webkitMatchesSelector)return n.webkitMatchesSelector(e);if(void 0!==n.mozMatchesSelector)return n.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},one:function(t,e){var n=void 0===e?document:e.dom();return tt(n)?W.none():W.from(n.querySelector(t)).map(Q.fromDom)}},nt=function(t,e){for(var n=[],r=function(t){return n.push(t),e(t)},o=e(t);(o=o.bind(r)).isSome(););return n},rt="undefined"!=typeof window?window:Function("return this;")(),ot=function(t,e){return function(t,e){for(var n=null!=e?e:rt,r=0;r<t.length&&null!=n;++r)n=n[t[r]];return n}(t.split("."),e)},it=function(){return function(t,e){var n=ot(t,e);if(null==n)throw t+" not available on this browser";return n}("Node")},at=function(t){var e,n=!1;return function(){return n||(n=!0,e=t.apply(null,arguments)),e}},ut=function(){return ct(0,0)},ct=function(t,e){return{major:t,minor:e}},lt=function(t,e){var n=String(e).toLowerCase();return 0===t.length?ut():function(t,e){var n=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.test(e))return r}}(t,e);if(!n)return{major:0,minor:0};var r=function(t){return Number(e.replace(n,"$"+t))};return ct(r(1),r(2))}(t,n)},st=ut,ft="Firefox",dt=function(t,e){return function(){return e===t}},mt=function(t){var e=t.current;return{current:e,version:t.version,isEdge:dt("Edge",e),isChrome:dt("Chrome",e),isIE:dt("IE",e),isOpera:dt("Opera",e),isFirefox:dt(ft,e),isSafari:dt("Safari",e)}},gt=function(){return mt({current:void 0,version:st()})},pt=mt,ht=(M.constant("Edge"),M.constant("Chrome"),M.constant("IE"),M.constant("Opera"),M.constant(ft),M.constant("Safari"),"Windows"),vt="Android",bt="Solaris",wt="FreeBSD",yt=function(t,e){return function(){return e===t}},xt=function(t){var e=t.current;return{current:e,version:t.version,isWindows:yt(ht,e),isiOS:yt("iOS",e),isAndroid:yt(vt,e),isOSX:yt("OSX",e),isLinux:yt("Linux",e),isSolaris:yt(bt,e),isFreeBSD:yt(wt,e)}},Ct=function(){return xt({current:void 0,version:st()})},Rt=xt,St=(M.constant(ht),M.constant("iOS"),M.constant(vt),M.constant("Linux"),M.constant("OSX"),M.constant(bt),M.constant(wt),function(t,e){var n=String(e).toLowerCase();return q.find(t,function(t){return t.search(n)})}),Tt=function(t,e,n){return""===e||!(t.length<e.length)&&t.substr(n,n+e.length)===e},Dt=function(t,e){return Tt(t,e,t.length-e.length)},kt=Dt,At=function(t,e){return-1!==t.indexOf(e)},Nt=function(t){return t.replace(/^\s+|\s+$/g,"")},Ot=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,It=function(e){return function(t){return At(t,e)}},Pt=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(t){return At(t,"edge/")&&At(t,"chrome")&&At(t,"safari")&&At(t,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Ot],search:function(t){return At(t,"chrome")&&!At(t,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(t){return At(t,"msie")||At(t,"trident")}},{name:"Opera",versionRegexes:[Ot,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:It("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:It("firefox")},{name:"Safari",versionRegexes:[Ot,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(t){return(At(t,"safari")||At(t,"mobile/"))&&At(t,"applewebkit")}}],Bt=[{name:"Windows",search:It("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(t){return At(t,"iphone")||At(t,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:It("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:It("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:It("linux"),versionRegexes:[]},{name:"Solaris",search:It("sunos"),versionRegexes:[]},{name:"FreeBSD",search:It("freebsd"),versionRegexes:[]}],Et={browsers:M.constant(Pt),oses:M.constant(Bt)},Mt=function(t){var e,n,r,o,i,a,u,c,l,s,f,d,m,g,p,h=Et.browsers(),v=Et.oses(),b=(g=h,p=t,St(g,p).map(function(t){var e=lt(t.versionRegexes,p);return{current:t.name,version:e}})).fold(gt,pt),w=(d=v,m=t,St(d,m).map(function(t){var e=lt(t.versionRegexes,m);return{current:t.name,version:e}})).fold(Ct,Rt);return{browser:b,os:w,deviceType:(n=b,r=t,o=(e=w).isiOS()&&!0===/ipad/i.test(r),i=e.isiOS()&&!o,a=e.isAndroid()&&3===e.version.major,u=e.isAndroid()&&4===e.version.major,c=o||a||u&&!0===/mobile/i.test(r),l=e.isiOS()||e.isAndroid(),s=l&&!c,f=n.isSafari()&&e.isiOS()&&!1===/safari/i.test(r),{isiPad:M.constant(o),isiPhone:M.constant(i),isTablet:M.constant(c),isPhone:M.constant(s),isTouch:M.constant(l),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:M.constant(f)})}},Wt={detect:at(function(){var t=navigator.userAgent;return Mt(t)})},jt=function(t,e){return t.dom()===e.dom()},qt=Wt.detect().browser.isIE()?function(t,e){return n=t.dom(),r=e.dom(),o=n,i=r,a=it().DOCUMENT_POSITION_CONTAINED_BY,0!=(o.compareDocumentPosition(i)&a);var n,r,o,i,a}:function(t,e){var n=t.dom(),r=e.dom();return n!==r&&n.contains(r)},Ht={eq:jt,isEqualNode:function(t,e){return t.dom().isEqualNode(e.dom())},member:function(t,e){return q.exists(e,M.curry(jt,t))},contains:qt,is:et.is},Lt=function(t){return Q.fromDom(t.dom().ownerDocument)},zt=function(t){var e=t.dom();return W.from(e.parentNode).map(Q.fromDom)},_t=function(t){var e=t.dom();return W.from(e.previousSibling).map(Q.fromDom)},Ft=function(t){var e=t.dom();return W.from(e.nextSibling).map(Q.fromDom)},Vt=function(t){var e=t.dom();return q.map(e.childNodes,Q.fromDom)},Ut=function(t,e){var n=t.dom().childNodes;return W.from(n[e]).map(Q.fromDom)},Gt=V.immutable("element","offset"),Yt={owner:Lt,defaultView:function(t){var e=t.dom().ownerDocument.defaultView;return Q.fromDom(e)},documentElement:function(t){var e=Lt(t);return Q.fromDom(e.dom().documentElement)},parent:zt,findIndex:function(n){return zt(n).bind(function(t){var e=Vt(t);return q.findIndex(e,function(t){return Ht.eq(n,t)})})},parents:function(t,e){for(var n=j.isFunction(e)?e:M.constant(!1),r=t.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,a=Q.fromDom(i);if(o.push(a),!0===n(a))break;r=i}return o},siblings:function(e){return zt(e).map(Vt).map(function(t){return q.filter(t,function(t){return!Ht.eq(e,t)})}).getOr([])},prevSibling:_t,offsetParent:function(t){var e=t.dom();return W.from(e.offsetParent).map(Q.fromDom)},prevSiblings:function(t){return q.reverse(nt(t,_t))},nextSibling:Ft,nextSiblings:function(t){return nt(t,Ft)},children:Vt,child:Ut,firstChild:function(t){return Ut(t,0)},lastChild:function(t){return Ut(t,t.dom().childNodes.length-1)},childNodesCount:function(t){return t.dom().childNodes.length},hasChildNodes:function(t){return t.dom().hasChildNodes()},leaf:function(t,e){var n=Vt(t);return 0<n.length&&e<n.length?Gt(n[e],0):Gt(t,e)}},Jt=function(t,e,n){return q.bind(Yt.children(t),function(t){return et.is(t,e)?n(t)?[t]:[]:Jt(t,e,n)})},Xt={firstLayer:function(t,e){return Jt(t,e,M.constant(!0))},filterFirstLayer:Jt},Kt=function(t){return t.dom().nodeName.toLowerCase()},Zt=function(t){return t.dom().nodeType},$t=function(e){return function(t){return Zt(t)===e}},Qt=$t(1),te=$t(3),ee=$t(9),ne={name:Kt,type:Zt,value:function(t){return t.dom().nodeValue},isElement:Qt,isText:te,isDocument:ee,isComment:function(t){return 8===Zt(t)||"#comment"===Kt(t)}},re=function(t,e,n){if(!(j.isString(n)||j.isBoolean(n)||j.isNumber(n)))throw console.error("Invalid call to Attr.set. Key ",e,":: Value ",n,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,n+"")},oe=function(t,e,n){re(t.dom(),e,n)},ie=function(t,e){var n=t.dom().getAttribute(e);return null===n?void 0:n},ae=function(t,e){var n=t.dom();return!(!n||!n.hasAttribute)&&n.hasAttribute(e)},ue={clone:function(t){return q.foldl(t.dom().attributes,function(t,e){return t[e.name]=e.value,t},{})},set:oe,setAll:function(t,e){var n=t.dom();E.each(e,function(t,e){re(n,e,t)})},get:ie,has:ae,remove:function(t,e){t.dom().removeAttribute(e)},hasNone:function(t){var e=t.dom().attributes;return null==e||0===e.length},transfer:function(o,i,t){ne.isElement(o)&&ne.isElement(i)&&q.each(t,function(t){var e,n,r;n=i,ae(e=o,r=t)&&!ae(n,r)&&oe(n,r,ie(e,r))})}},ce=at(function(){return le(Q.fromDom(document))}),le=function(t){var e=t.dom().body;if(null==e)throw"Body is not available yet";return Q.fromDom(e)},se={body:ce,getBody:le,inBody:function(t){var e=ne.isText(t)?t.dom().parentNode:t.dom();return null!=e&&e.ownerDocument.body.contains(e)}},fe=function(t,e){var n=[];return q.each(Yt.children(t),function(t){e(t)&&(n=n.concat([t])),n=n.concat(fe(t,e))}),n},de={all:function(t){return fe(se.body(),t)},ancestors:function(t,e,n){return q.filter(Yt.parents(t,n),e)},siblings:function(t,e){return q.filter(Yt.siblings(t),e)},children:function(t,e){return q.filter(Yt.children(t),e)},descendants:fe},me={all:function(t){return et.all(t)},ancestors:function(t,e,n){return de.ancestors(t,function(t){return et.is(t,e)},n)},siblings:function(t,e){return de.siblings(t,function(t){return et.is(t,e)})},children:function(t,e){return de.children(t,function(t){return et.is(t,e)})},descendants:function(t,e){return et.all(e,t)}};function ge(t,e,n,r,o){return t(n,r)?W.some(n):j.isFunction(o)&&o(n)?W.none():e(n,r,o)}var pe,he,ve,be,we=function(t,e,n){for(var r=t.dom(),o=j.isFunction(n)?n:M.constant(!1);r.parentNode;){r=r.parentNode;var i=Q.fromDom(r);if(e(i))return W.some(i);if(o(i))break}return W.none()},ye=function(t,e){return q.find(t.dom().childNodes,M.compose(e,Q.fromDom)).map(Q.fromDom)},xe=function(t,r){var o=function(t){for(var e=0;e<t.childNodes.length;e++){if(r(Q.fromDom(t.childNodes[e])))return W.some(Q.fromDom(t.childNodes[e]));var n=o(t.childNodes[e]);if(n.isSome())return n}return W.none()};return o(t.dom())},Ce={first:function(t){return xe(se.body(),t)},ancestor:we,closest:function(t,e,n){return ge(function(t){return e(t)},we,t,e,n)},sibling:function(e,n){var t=e.dom();return t.parentNode?ye(Q.fromDom(t.parentNode),function(t){return!Ht.eq(e,t)&&n(t)}):W.none()},child:ye,descendant:xe},Re=function(t,e,n){return Ce.ancestor(t,function(t){return et.is(t,e)},n)},Se={first:function(t){return et.one(t)},ancestor:Re,sibling:function(t,e){return Ce.sibling(t,function(t){return et.is(t,e)})},child:function(t,e){return Ce.child(t,function(t){return et.is(t,e)})},descendant:function(t,e){return et.one(e,t)},closest:function(t,e,n){return ge(et.is,Re,t,e,n)}},Te=function(t,e,n){var r=void 0!==n?n:M.constant(!1);return r(e)?W.none():q.contains(t,ne.name(e))?W.some(e):Se.ancestor(e,t.join(","),function(t){return et.is(t,"table")||r(t)})},De=function(e,t){return Yt.parent(t).map(function(t){return me.children(t,e)})},ke=(M.curry(De,"th,td"),M.curry(De,"tr"),function(t,e){return Te(["td","th"],t,e)}),Ae=function(t){return Xt.firstLayer(t,"th,td")},Ne=function(t,e){return Se.closest(t,"table",e)},Oe=function(t){return Xt.firstLayer(t,"tr")},Ie=function(t){var e=Oe(t);return q.map(e,function(t){var e=t,n=Yt.parent(e).bind(function(t){var e=ne.name(t);return"tfoot"===e||"thead"===e||"tbody"===e?e:"tbody"}),r=q.map(Ae(t),function(t){var e=ue.has(t,"rowspan")?parseInt(ue.get(t,"rowspan"),10):1,n=ue.has(t,"colspan")?parseInt(ue.get(t,"colspan"),10):1;return Z.detail(t,e,n)});return Z.rowdata(e,r,n)})},Pe=function(t,e){return t+","+e},Be=function(t,e){var n=q.bind(t.all(),function(t){return t.cells()});return q.filter(n,e)},Ee=function(t){var s={},e=[],n=t.length,f=0;q.each(t,function(t,c){var l=[];q.each(t.cells(),function(t,e){for(var n=0;void 0!==s[Pe(c,n)];)n++;for(var r=Z.extended(t.element(),t.rowspan(),t.colspan(),c,n),o=0;o<t.colspan();o++)for(var i=0;i<t.rowspan();i++){var a=n+o,u=Pe(c+i,a);s[u]=r,f=Math.max(f,a+1)}l.push(r)}),e.push(Z.rowdata(t.element(),l,t.section()))});var r=Z.grid(n,f);return{grid:M.constant(r),access:M.constant(s),all:M.constant(e)}},Me=function(t,e,n){var r=t.access()[Pe(e,n)];return void 0!==r?W.some(r):W.none()},We=function(t,e,n){var r=Be(t,function(t){return n(e,t.element())});return 0<r.length?W.some(r[0]):W.none()},je=Be,qe=function(t){var e=q.map(t.all(),function(t){return t.cells()});return q.flatten(e)},He=function(t){return void 0!==t.style},Le=function(t,e,n){if(!j.isString(n))throw console.error("Invalid call to CSS.set. Property ",e,":: Value ",n,":: Element ",t),new Error("CSS value must be a string: "+n);He(t)&&t.style.setProperty(e,n)},ze=function(t,e){He(t)&&t.style.removeProperty(e)},_e=function(t,e,n){var r=t.dom();Le(r,e,n)},Fe=function(t,e){return He(t)?t.style.getPropertyValue(e):""},Ve=function(t,e){var n=t.dom(),r=Fe(n,e);return W.from(r).filter(function(t){return 0<t.length})},Ue={copy:function(t,e){var n=t.dom(),r=e.dom();He(n)&&He(r)&&(r.style.cssText=n.style.cssText)},set:_e,preserve:function(t,e){var n=ue.get(t,"style"),r=e(t);return(void 0===n?ue.remove:ue.set)(t,"style",n),r},setAll:function(t,e){var n=t.dom();E.each(e,function(t,e){Le(n,e,t)})},setOptions:function(t,e){var n=t.dom();E.each(e,function(t,e){t.fold(function(){ze(n,e)},function(t){Le(n,e,t)})})},remove:function(t,e){var n=t.dom();ze(n,e),ue.has(t,"style")&&""===Nt(ue.get(t,"style"))&&ue.remove(t,"style")},get:function(t,e){var n=t.dom(),r=window.getComputedStyle(n).getPropertyValue(e),o=""!==r||se.inBody(t)?r:Fe(n,e);return null===o?void 0:o},getRaw:Ve,getAllRaw:function(t){var e={},n=t.dom();if(He(n))for(var r=0;r<n.style.length;r++){var o=n.style.item(r);e[o]=n.style[o]}return e},isValidValue:function(t,e,n){var r=Q.fromTag(t);return _e(r,e,n),Ve(r,e).isSome()},reflow:function(t){return t.dom().offsetWidth},transfer:function(r,o,t){ne.isElement(r)&&ne.isElement(o)&&q.each(t,function(t){var e,n;e=o,Ve(r,n=t).each(function(t){Ve(e,n).isNone()&&_e(e,n,t)})})}},Ge=function(e,n){Yt.parent(e).each(function(t){t.dom().insertBefore(n.dom(),e.dom())})},Ye=function(t,e){t.dom().appendChild(e.dom())},Je={before:Ge,after:function(t,e){Yt.nextSibling(t).fold(function(){Yt.parent(t).each(function(t){Ye(t,e)})},function(t){Ge(t,e)})},prepend:function(e,n){Yt.firstChild(e).fold(function(){Ye(e,n)},function(t){e.dom().insertBefore(n.dom(),t.dom())})},append:Ye,appendAt:function(t,e,n){Yt.child(t,n).fold(function(){Ye(t,e)},function(t){Ge(t,e)})},wrap:function(t,e){Ge(t,e),Ye(e,t)}},Xe={before:function(e,t){q.each(t,function(t){Je.before(e,t)})},after:function(r,o){q.each(o,function(t,e){var n=0===e?r:o[e-1];Je.after(n,t)})},prepend:function(e,t){q.each(t.slice().reverse(),function(t){Je.prepend(e,t)})},append:function(e,t){q.each(t,function(t){Je.append(e,t)})}},Ke=function(t){var e=t.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},Ze={empty:function(t){t.dom().textContent="",q.each(Yt.children(t),function(t){Ke(t)})},remove:Ke,unwrap:function(t){var e=Yt.children(t);0<e.length&&Xe.before(t,e),Ke(t)}},$e=V.immutable("minRow","minCol","maxRow","maxCol"),Qe=function(t,e){return Q.fromDom(t.dom().cloneNode(e))},tn=function(t){return Qe(t,!0)},en=function(t){return Qe(t,!1)},nn=tn,rn=function(t,e){var n,r,o,i=(n=t,r=Q.fromTag(e),o=ue.clone(n),ue.setAll(r,o),r),a=Yt.children(tn(t));return Xe.append(i,a),i},on=(pe=ne.isText,"text",he=function(t){return pe(t)?W.from(t.dom().nodeValue):W.none()},ve=Wt.detect().browser,{get:function(t){if(!pe(t))throw new Error("Can only get text value of a text node");return be(t).getOr("")},getOption:be=ve.isIE()&&10===ve.version.major?function(t){try{return he(t)}catch(t){return W.none()}}:he,set:function(t,e){if(!pe(t))throw new Error("Can only set raw text value of a text node");t.dom().nodeValue=e}}),an={get:function(t){return on.get(t)},getOption:function(t){return on.getOption(t)},set:function(t,e){on.set(t,e)}},un=["img","br"],cn=function(t){return"img"===ne.name(t)?1:an.getOption(t).fold(function(){return Yt.children(t).length},function(t){return t.length})},ln=function(t){return an.getOption(t).filter(function(t){return 0!==t.trim().length||-1<t.indexOf("Â ")}).isSome()||q.contains(un,ne.name(t))},sn=function(t){return Ce.descendant(t,ln)},fn=function(t){return i=ln,(a=function(t){for(var e=Yt.children(t),n=e.length-1;0<=n;n--){var r=e[n];if(i(r))return W.some(r);var o=a(r);if(o.isSome())return o}return W.none()})(t);var i,a},dn=function(){var t=Q.fromTag("td");return Je.append(t,Q.fromTag("br")),t},mn=function(t,e,n){var r=rn(t,e);return E.each(n,function(t,e){null===t?ue.remove(r,e):ue.set(r,e,t)}),r},gn=function(t){return t},pn=function(t){return function(){return Q.fromTag("tr",t.dom())}},hn=function(c,t,l){return{row:pn(t),cell:function(t){var r,o,i,e=Yt.owner(t.element()),n=Q.fromTag(ne.name(t.element()),e.dom()),a=l.getOr(["strong","em","b","i","span","font","h1","h2","h3","h4","h5","h6","p","div"]),u=0<a.length?(r=t.element(),o=n,i=a,sn(r).map(function(t){var e=i.join(","),n=me.ancestors(t,e,function(t){return Ht.eq(t,r)});return q.foldr(n,function(t,e){var n=en(e);return Je.append(t,n),n},o)}).getOr(o)):n;return Je.append(u,Q.fromTag("br")),Ue.copy(t.element(),n),Ue.remove(n,"height"),1!==t.colspan()&&Ue.remove(t.element(),"width"),c(t.element(),n),n},replace:mn,gap:dn}},vn=function(t){return{row:pn(t),cell:dn,replace:gn,gap:dn}},bn=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];function wn(){return{up:M.constant({selector:Se.ancestor,closest:Se.closest,predicate:Ce.ancestor,all:Yt.parents}),down:M.constant({selector:me.descendants,predicate:de.descendants}),styles:M.constant({get:Ue.get,getRaw:Ue.getRaw,set:Ue.set,remove:Ue.remove}),attrs:M.constant({get:ue.get,set:ue.set,remove:ue.remove,copyTo:function(t,e){var n=ue.clone(t);ue.setAll(e,n)}}),insert:M.constant({before:Je.before,after:Je.after,afterAll:Xe.after,append:Je.append,appendAll:Xe.append,prepend:Je.prepend,wrap:Je.wrap}),remove:M.constant({unwrap:Ze.unwrap,remove:Ze.remove}),create:M.constant({nu:Q.fromTag,clone:function(t){return Q.fromDom(t.dom().cloneNode(!1))},text:Q.fromText}),query:M.constant({comparePosition:function(t,e){return t.dom().compareDocumentPosition(e.dom())},prevSibling:Yt.prevSibling,nextSibling:Yt.nextSibling}),property:M.constant({children:Yt.children,name:ne.name,parent:Yt.parent,isText:ne.isText,isComment:ne.isComment,isElement:ne.isElement,getText:an.get,setText:an.set,isBoundary:function(t){return!!ne.isElement(t)&&("body"===ne.name(t)||q.contains(bn,ne.name(t)))},isEmptyTag:function(t){return!!ne.isElement(t)&&q.contains(["br","img","hr","input"],ne.name(t))}}),eq:Ht.eq,is:Ht.is}}V.immutable("left","right");var yn=function(e,t,n){return t.bind(function(t){return n.filter(M.curry(e.eq,t))})},xn=function(t,e,n){return 0<n.length?(r=t,o=e,i=(c=n)[0],a=c.slice(1),u=o(r,i),q.foldr(a,function(t,e){var n=o(r,e);return yn(r,t,n)},u)):W.none();var r,o,i,a,u,c},Cn=function(t,e){return M.curry(t.eq,e)},Rn=function(e,t,n,r){var o=void 0!==r?r:M.constant(!1),i=[t].concat(e.up().all(t)),a=[n].concat(e.up().all(n)),u=function(e){return q.findIndex(e,o).fold(function(){return e},function(t){return e.slice(0,t+1)})},c=u(i),l=u(a),s=q.find(c,function(t){return q.exists(l,Cn(e,t))});return{firstpath:M.constant(c),secondpath:M.constant(l),shared:M.constant(s)}},Sn=Rn,Tn=wn(),Dn=function(n,t){return xn(Tn,function(t,e){return n(e)},t)},kn=function(t,e,n){return Sn(Tn,t,e,n)},An=function(t,e){return e.column()>=t.startCol()&&e.column()+e.colspan()-1<=t.finishCol()&&e.row()>=t.startRow()&&e.row()+e.rowspan()-1<=t.finishRow()},Nn=function(t,e){var n=e.column(),r=e.column()+e.colspan()-1,o=e.row(),i=e.row()+e.rowspan()-1;return n<=t.finishCol()&&r>=t.startCol()&&o<=t.finishRow()&&i>=t.startRow()},On=function(t,e,n){var r=We(t,e,Ht.eq),o=We(t,n,Ht.eq);return r.bind(function(r){return o.map(function(t){return e=r,n=t,Z.bounds(Math.min(e.row(),n.row()),Math.min(e.column(),n.column()),Math.max(e.row()+e.rowspan()-1,n.row()+n.rowspan()-1),Math.max(e.column()+e.colspan()-1,n.column()+n.colspan()-1));var e,n})})},In=On,Pn=function(e,t,n){return On(e,t,n).bind(function(t){return function(t,e){for(var n=!0,r=M.curry(An,e),o=e.startRow();o<=e.finishRow();o++)for(var i=e.startCol();i<=e.finishCol();i++)n=n&&Me(t,o,i).exists(r);return n?W.some(e):W.none()}(e,t)})},Bn=function(n,t,e){return In(n,t,e).map(function(t){var e=je(n,M.curry(Nn,t));return q.map(e,function(t){return t.element()})})},En=function(t,e){return We(t,e,function(t,e){return Ht.contains(e,t)}).bind(function(t){return t.element()})},Mn=function(t){var e=Ie(t);return Ee(e)},Wn=function(n,a,u){return Ne(n).bind(function(t){var r,o,i,e=Mn(t);return o=a,i=u,We(r=e,n,Ht.eq).bind(function(t){var e=0<o?t.row()+t.rowspan()-1:t.row(),n=0<i?t.column()+t.colspan()-1:t.column();return Me(r,e+o,n+i).map(function(t){return t.element()})})})},jn=function(t,e,n,r,o){var i=Mn(t),a=Ht.eq(t,n)?e:En(i,e),u=Ht.eq(t,o)?r:En(i,r);return Bn(i,a,u)},qn=function(t,e){return Se.ancestor(t,"table")},Hn=V.immutableBag(["boxes","start","finish"],[]),Ln=function(l,s,f){var d=function(e){return function(t){return f(t)||Ht.eq(t,e)}};return Ht.eq(l,s)?W.some(Hn({boxes:W.some([l]),start:l,finish:s})):qn(l).bind(function(c){return qn(s).bind(function(i){if(Ht.eq(c,i))return W.some(Hn({boxes:(t=c,e=l,n=s,r=Mn(t),Bn(r,e,n)),start:l,finish:s}));var t,e,n,r;if(Ht.contains(c,i)){var o=0<(a=me.ancestors(s,"td,th",d(c))).length?a[a.length-1]:s;return W.some(Hn({boxes:jn(c,l,c,s,i),start:l,finish:o}))}if(Ht.contains(i,c)){var a,u=0<(a=me.ancestors(l,"td,th",d(i))).length?a[a.length-1]:l;return W.some(Hn({boxes:jn(i,l,c,s,i),start:l,finish:u}))}return kn(l,s).shared().bind(function(t){return Se.closest(t,"table",f).bind(function(t){var e=me.ancestors(s,"td,th",d(t)),n=0<e.length?e[e.length-1]:s,r=me.ancestors(l,"td,th",d(t)),o=0<r.length?r[r.length-1]:l;return W.some(Hn({boxes:jn(t,l,c,s,i),start:o,finish:n}))})})})})},zn=Ln,_n=function(t,e){var n=me.descendants(t,e);return 0<n.length?W.some(n):W.none()},Fn=function(t,e,r){return Se.descendant(t,e).bind(function(n){return Se.descendant(t,r).bind(function(e){return Dn(qn,[n,e]).map(function(t){return{first:M.constant(n),last:M.constant(e),table:M.constant(t)}})})})},Vn=function(r,t,e){return Fn(r,t,e).bind(function(a){var t=function(t){return Ht.eq(r,t)},e=Se.ancestor(a.first(),"thead,tfoot,tbody,table",t),n=Se.ancestor(a.last(),"thead,tfoot,tbody,table",t);return e.bind(function(i){return n.bind(function(t){return Ht.eq(i,t)?(e=a.table(),n=a.first(),r=a.last(),o=Mn(e),Pn(o,n,r)):W.none();var e,n,r,o})})})},Un={selected:M.constant("data-mce-selected"),selectedSelector:M.constant("td[data-mce-selected],th[data-mce-selected]"),attributeSelector:M.constant("[data-mce-selected]"),firstSelected:M.constant("data-mce-first-selected"),firstSelectedSelector:M.constant("td[data-mce-first-selected],th[data-mce-first-selected]"),lastSelected:M.constant("data-mce-last-selected"),lastSelectedSelector:M.constant("td[data-mce-last-selected],th[data-mce-last-selected]")},Gn=function(a){if(!j.isArray(a))throw new Error("cases must be an array");if(0===a.length)throw new Error("there must be at least one case");var u=[],n={};return q.each(a,function(t,r){var e=E.keys(t);if(1!==e.length)throw new Error("one and only one name per case");var o=e[0],i=t[o];if(void 0!==n[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!j.isArray(i))throw new Error("case arguments must be an array");u.push(o),n[o]=function(){var t=arguments.length;if(t!==i.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+i.length+" ("+i+"), got "+t);for(var n=new Array(t),e=0;e<n.length;e++)n[e]=arguments[e];return{fold:function(){if(arguments.length!==a.length)throw new Error("Wrong number of arguments to fold. Expected "+a.length+", got "+arguments.length);return arguments[r].apply(null,n)},match:function(t){var e=E.keys(t);if(u.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+u.join(",")+"\nActual: "+e.join(","));if(!q.forall(u,function(t){return q.contains(e,t)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+u.join(", "));return t[o].apply(null,n)},log:function(t){console.log(t,{constructors:u,constructor:o,params:n})}}}}),n},Yn=Gn([{none:[]},{multiple:["elements"]},{single:["selection"]}]),Jn={cata:function(t,e,n,r){return t.fold(e,n,r)},none:Yn.none,multiple:Yn.multiple,single:Yn.single},Xn=function(t,e){return Jn.cata(e.get(),M.constant([]),M.identity,M.constant([t]))},Kn=Xn,Zn=function(t){return{element:M.constant(t),mergable:W.none,unmergable:W.none,selection:M.constant([t])}},$n=V.immutable("element","clipboard","generators"),Qn={noMenu:Zn,forMenu:function(t,e,n){return{element:M.constant(n),mergable:M.constant((a=e,u=t,Jn.cata(u.get(),W.none,function(e,t){return 0===e.length?W.none():Vn(a,Un.firstSelectedSelector(),Un.lastSelectedSelector()).bind(function(t){return 1<e.length?W.some({bounds:M.constant(t),cells:M.constant(e)}):W.none()})},W.none))),unmergable:M.constant((r=n,o=t,i=Xn(r,o),0<i.length&&q.forall(i,function(t){return ue.has(t,"rowspan")&&1<parseInt(ue.get(t,"rowspan"),10)||ue.has(t,"colspan")&&1<parseInt(ue.get(t,"colspan"),10)})?W.some(i):W.none())),selection:M.constant(Kn(n,t))};var r,o,i,a,u},notCell:function(t){return Zn(t)},paste:$n,pasteRows:function(t,e,n,r,o){return{element:M.constant(n),mergable:W.none,unmergable:W.none,selection:M.constant(Kn(n,t)),clipboard:M.constant(r),generators:M.constant(o)}}},tr=function(s,t,f,d){s.on("BeforeGetContent",function(n){!0===n.selection&&Jn.cata(t.get(),M.noop,function(t){var e;n.preventDefault(),(e=t,Ne(e[0]).map(nn).map(function(t){return[(e=t,n=Un.attributeSelector(),m=function(t){return et.is(t.element(),n)},g=Ie(e),p=Ee(g),i=m,o=(r=p).grid().columns(),a=r.grid().rows(),u=o,l=c=0,E.each(r.access(),function(t){if(i(t)){var e=t.row(),n=e+t.rowspan()-1,r=t.column(),o=r+t.colspan()-1;e<a?a=e:c<n&&(c=n),r<u?u=r:l<o&&(l=o)}}),h=$e(a,u,c,l),v="th:not("+n+"),td:not("+n+")",b=Xt.filterFirstLayer(e,"th,td",function(t){return et.is(t,v)}),q.each(b,Ze.remove),function(t,e,n,r){for(var o,i,a,u=e.grid().columns(),c=e.grid().rows(),l=0;l<c;l++)for(var s=!1,f=0;f<u;f++)l<n.minRow()||l>n.maxRow()||f<n.minCol()||f>n.maxCol()||(Me(e,l,f).filter(r).isNone()?(o=s,i=t[l].element(),a=Q.fromTag("td"),Je.append(a,Q.fromTag("br")),(o?Je.append:Je.prepend)(i,a)):s=!0)}(g,p,h,m),s=e,f=h,d=q.filter(Xt.firstLayer(s,"tr"),function(t){return 0===t.dom().childElementCount}),q.each(d,Ze.remove),f.minCol()!==f.maxCol()&&f.minRow()!==f.maxRow()||q.each(Xt.firstLayer(s,"th,td"),function(t){ue.remove(t,"rowspan"),ue.remove(t,"colspan")}),ue.remove(s,"width"),ue.remove(s,"height"),Ue.remove(s,"width"),Ue.remove(s,"height"),e)];var e,n,r,i,o,a,u,c,l,s,f,d,m,g,p,h,v,b})).each(function(t){n.content=q.map(t,function(t){return e=t,s.selection.serializer.serialize(e.dom(),{});var e}).join("")})},M.noop)}),s.on("BeforeSetContent",function(l){!0===l.selection&&!0===l.paste&&W.from(s.dom.getParent(s.selection.getStart(),"th,td")).each(function(t){var c=Q.fromDom(t);Ne(c).bind(function(e){var t,n,r,o=q.filter((t=l.content,(r=(n||document).createElement("div")).innerHTML=t,Yt.children(Q.fromDom(r))),function(t){return"meta"!==ne.name(t)});if(1===o.length&&"table"===ne.name(o[0])){l.preventDefault();var i=Q.fromDom(s.getDoc()),a=vn(i),u=Qn.paste(c,o[0],a);f.pasteCells(e,u).each(function(t){s.selection.setRng(t),s.focus(),d.clear(e)})}})})})};function er(r,o){var t=function(t){var e=o(t);if(e<=0||null===e){var n=Ue.get(t,r);return parseFloat(n)||0}return e},i=function(o,t){return q.foldl(t,function(t,e){var n=Ue.get(o,e),r=void 0===n?0:parseInt(n,10);return isNaN(r)?t:t+r},0)};return{set:function(t,e){if(!j.isNumber(e)&&!e.match(/^[0-9]+$/))throw r+".set accepts only positive integer values. Value was "+e;var n=t.dom();He(n)&&(n.style[r]=e+"px")},get:t,getOuter:t,aggregate:i,max:function(t,e,n){var r=i(t,n);return r<e?e-r:0}}}var nr=er("height",function(t){return se.inBody(t)?t.dom().getBoundingClientRect().height:t.dom().offsetHeight}),rr=function(t){return nr.get(t)},or=function(t){return nr.getOuter(t)},ir=er("width",function(t){return t.dom().offsetWidth}),ar=function(t){return ir.get(t)},ur=function(t){return ir.getOuter(t)},cr=Wt.detect(),lr=function(t,e,n){return r=Ue.get(t,e),o=n,i=parseFloat(r),isNaN(i)?o:i;var r,o,i},sr=/(\d+(\.\d+)?)(\w|%)*/,fr=/(\d+(\.\d+)?)%/,dr=/(\d+(\.\d+)?)px|em/,mr=function(t,e){Ue.set(t,"height",e+"px")},gr=function(t){var u,e,n,r,o,i,a,c,l,s,f=Ue.getRaw(u=t,"height").getOrThunk(function(){return t=u,(cr.browser.isIE()||cr.browser.isEdge()?(n=lr(e=t,"padding-top",0),r=lr(e,"padding-bottom",0),o=lr(e,"border-top-width",0),i=lr(e,"border-bottom-width",0),a=e.dom().getBoundingClientRect().height,"border-box"===Ue.get(e,"box-sizing")?a:a-n-r-(o+i)):lr(t,"height",rr(t)))+"px";var t,e,n,r,o,i,a});return f?(e=f,n=t,r=rr,o=mr,s=parseInt(e,10),kt(e,"%")&&"table"!==ne.name(n)?(a=s,c=r,o(i=n,l=Ne(i).map(function(t){var e=c(t);return Math.floor(a/100*e)}).getOr(a)),l):s):rr(t)},pr=function(t){return Ue.getRaw(t,"width").fold(function(){return W.from(ue.get(t,"width"))},function(t){return W.some(t)})},hr=function(t,e){return t/e.pixelWidth()*100},vr={percentageBasedSizeRegex:M.constant(fr),pixelBasedSizeRegex:M.constant(dr),setPixelWidth:function(t,e){Ue.set(t,"width",e+"px")},setPercentageWidth:function(t,e){Ue.set(t,"width",e+"%")},setHeight:mr,getPixelWidth:function(e,n){return pr(e).fold(function(){var t=ar(e);return parseInt(t,10)},function(t){return function(t,e,n){if(dr.test(e)){var r=dr.exec(e);return parseInt(r[1],10)}if(fr.test(e)){var o=fr.exec(e);return parseFloat(o[1])/100*n.pixelWidth()}var i=ar(t);return parseInt(i,10)}(e,t,n)})},getPercentageWidth:function(n,r){return pr(n).fold(function(){var t=ar(n),e=parseInt(t,10);return hr(e,r)},function(t){return function(t,e,n){if(fr.test(e)){var r=fr.exec(e);return parseFloat(r[1])}var o=ar(t),i=parseInt(o,10);return hr(i,n)}(n,t,r)})},getGenericWidth:function(t){return pr(t).bind(function(t){if(sr.test(t)){var e=sr.exec(t);return W.some({width:M.constant(e[1]),unit:M.constant(e[3])})}return W.none()})},setGenericWidth:function(t,e,n){Ue.set(t,"width",e+n)},getHeight:function(t){return"rowspan",gr(r=t)/(ue.has(e=r,n="rowspan")?parseInt(ue.get(e,n),10):1);var e,n,r},getRawWidth:pr},br=function(n,r){vr.getGenericWidth(n).each(function(t){var e=t.width()/2;vr.setGenericWidth(n,e,t.unit()),vr.setGenericWidth(r,e,t.unit())})},wr=function(n,r){return{left:M.constant(n),top:M.constant(r),translate:function(t,e){return wr(n+t,r+e)}}},yr=function(t,e){return void 0!==t?t:void 0!==e?e:0},xr=function(t){var e,n,r,o=t.dom(),i=o.ownerDocument,a=i.body,u=Q.fromDom(i.documentElement);return a===o?wr(a.offsetLeft,a.offsetTop):(n=t,r=u||Q.fromDom(document.documentElement),Ce.ancestor(n,M.curry(Ht.eq,r)).isSome()?(e=o.getBoundingClientRect(),wr(e.left,e.top)):wr(0,0))},Cr=function(t){var e,n,r=t.dom().ownerDocument,o=r.body,i=(e=Q.fromDom(r),(n=e.dom())===n.window?e:ne.isDocument(e)?n.defaultView||n.parentWindow:null),a=r.documentElement,u=yr(i.pageYOffset,a.scrollTop),c=yr(i.pageXOffset,a.scrollLeft),l=yr(a.clientTop,o.clientTop),s=yr(a.clientLeft,o.clientLeft);return xr(t).translate(c-s,u-l)},Rr=V.immutable("row","y"),Sr=V.immutable("col","x"),Tr=function(t){return Cr(t).left()+ur(t)},Dr=function(t){return Cr(t).left()},kr=function(t,e){return Sr(t,Dr(e))},Ar=function(t,e){return Sr(t,Tr(e))},Nr=function(t){return Cr(t).top()},Or=function(n,e,r){if(0===r.length)return[];var t=q.map(r.slice(1),function(t,e){return t.map(function(t){return n(e,t)})}),o=r[r.length-1].map(function(t){return e(r.length-1,t)});return t.concat([o])},Ir={delta:M.identity,positions:M.curry(Or,function(t,e){return Rr(t,Nr(e))},function(t,e){return Rr(t,Nr(e)+or(e))}),edge:Nr},Pr={delta:M.identity,edge:Dr,positions:M.curry(Or,kr,Ar)},Br={height:Ir,rtl:{delta:function(t,e){return-t},edge:Tr,positions:M.curry(Or,Ar,kr)},ltr:Pr},Er={ltr:Br.ltr,rtl:Br.rtl};function Mr(e){var n=function(t){return e(t).isRtl()?Er.rtl:Er.ltr};return{delta:function(t,e){return n(e).delta(t,e)},edge:function(t){return n(t).edge(t)},positions:function(t,e){return n(e).positions(t,e)}}}var Wr=function(t){var e=Ie(t);return Ee(e).grid()},jr=function(t){var e=t,n=function(){return e};return{get:n,set:function(t){e=t},clone:function(){return jr(n())}}},qr=function(t,e){return Hr(t,e,{validate:j.isFunction,label:"function"})},Hr=function(r,o,i){if(0===o.length)throw new Error("You must specify at least one required field.");return _("required",o),F(o),function(e){var n=E.keys(e);q.forall(o,function(t){return q.contains(n,t)})||L(o,n),r(o,n);var t=q.filter(o,function(t){return!i.validate(e[t],t)});return 0<t.length&&function(t,e){throw new Error("All values need to be of type: "+e+". Keys ("+H(t).join(", ")+") were not.")}(t,i.label),e}},Lr=M.noop,zr={exactly:M.curry(qr,function(e,t){var n=q.filter(t,function(t){return!q.contains(e,t)});0<n.length&&z(n)}),ensure:M.curry(qr,Lr),ensureWith:M.curry(Hr,Lr)},_r=function(t){var e=ue.has(t,"colspan")?parseInt(ue.get(t,"colspan"),10):1,n=ue.has(t,"rowspan")?parseInt(ue.get(t,"rowspan"),10):1;return{element:M.constant(t),colspan:M.constant(e),rowspan:M.constant(n)}},Fr=zr.exactly(["cell","row","replace","gap"]),Vr=function(r,t){Fr(r);var o=jr(W.none()),i=void 0!==t?t:_r,a=function(t){var e,n=(e=i(t),r.cell(e));return o.get().isNone()&&o.set(W.some(n)),u=W.some({item:t,replacement:n}),n},u=W.none();return{getOrInit:function(e,n){return u.fold(function(){return a(e)},function(t){return n(e,t.item)?t.replacement:a(e)})},cursor:o.get}},Ur=function(o,u){return function(n){var r=jr(W.none());Fr(n);var i=[],a=function(t){var e=n.replace(t,u,{scope:o});return i.push({item:t,sub:e}),r.get().isNone()&&r.set(W.some(e)),e};return{replaceOrInit:function(e,n){return(r=e,o=n,q.find(i,function(t){return o(t.item,r)})).fold(function(){return a(e)},function(t){return n(e,t.item)?t.sub:a(e)});var r,o},cursor:r.get}}},Gr=function(n){Fr(n);var t=jr(W.none());return{combine:function(e){return t.get().isNone()&&t.set(W.some(e)),function(){var t=n.cell({element:M.constant(e),colspan:M.constant(1),rowspan:M.constant(1)});return Ue.remove(t,"width"),Ue.remove(e,"width"),t}},cursor:t.get}},Yr=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","table","thead","tfoot","tbody","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"],Jr=function(t,e){var n=t.property().name(e);return q.contains(Yr,n)},Xr=function(t,e){return q.contains(["br","img","hr","input"],t.property().name(e))},Kr=wn(),Zr=function(t){return Jr(Kr,t)},$r=function(t){return e=t,n=Kr.property().name(e),q.contains(["ol","ul"],n);var e,n},Qr=function(t){var e,i=function(t){return"br"===ne.name(t)},r=function(o){return fn(o).bind(function(n){var r=Yt.nextSibling(n).map(function(t){return!!Zr(t)||(Xr(Kr,t)?"img"!==ne.name(t):void 0)}).getOr(!1);return Yt.parent(n).map(function(t){return!0===r||(e=t,"li"===ne.name(e)||Ce.ancestor(e,$r).isSome())||i(n)||Zr(t)&&!Ht.eq(o,t)?[]:[Q.fromTag("br")];var e})}).getOr([])},n=0===(e=q.bind(t,function(t){var e,n=Yt.children(t);return e=n,q.forall(e,function(t){return i(t)||ne.isText(t)&&0===an.get(t).trim().length})?[]:n.concat(r(t))})).length?[Q.fromTag("br")]:e;Ze.empty(t[0]),Xe.append(t[0],n)},to=function(a){return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(0===t.length)throw new Error("Can't merge zero objects");for(var n={},r=0;r<t.length;r++){var o=t[r];for(var i in o)o.hasOwnProperty(i)&&(n[i]=a(n[i],o[i]))}return n}},eo=to(function(t,e){return j.isObject(t)&&j.isObject(e)?eo(t,e):e}),no=to(function(t,e){return e}),ro={deepMerge:eo,merge:no},oo=function(t){for(var e=[],n=function(t){e.push(t)},r=0;r<t.length;r++)t[r].each(n);return e},io=function(t,e){for(var n=0;n<t.length;n++){var r=e(t[n],n);if(r.isSome())return r}return W.none()},ao=function(t,e){return Z.rowcells(e,t.section())},uo=function(t,e){return t.cells()[e]},co=function(t,e,n){var r=t.cells(),o=r.slice(0,e),i=r.slice(e),a=o.concat([n]).concat(i);return ao(t,a)},lo=ao,so=function(t,e,n){t.cells()[e]=n},fo=uo,mo=function(t,e){return uo(t,e).element()},go=function(t,e){var n=t.cells(),r=q.map(n,e);return Z.rowcells(r,t.section())},po=function(t){return t.cells().length},ho=function(t,e){if(0===t.length)return 0;var n=t[0];return q.findIndex(t,function(t){return!e(n.element(),t.element())}).fold(function(){return t.length},function(t){return t})},vo=function(h,v){var b=q.map(h,function(t,e){return q.map(t.cells(),function(t,e){return!1})});return q.map(h,function(t,p){var e=q.bind(t.cells(),function(t,e){if(!1===b[p][e]){var n=(i=e,a=v,f=(u=r=h,c=o=p,u[c]).cells().slice(i),d=ho(f,a),m=(l=r,s=i,q.map(l,function(t){return fo(t,s)})).slice(o),g=ho(m,a),{colspan:M.constant(d),rowspan:M.constant(g)});return function(t,e,n,r){for(var o=t;o<t+n;o++)for(var i=e;i<e+r;i++)b[o][i]=!0}(p,e,n.rowspan(),n.colspan()),[Z.detailnew(t.element(),n.rowspan(),n.colspan(),t.isNew())]}var r,o,i,a,u,c,l,s,f,d,m,g;return[]});return Z.rowdetails(e,t.section())})},bo=function(t,e,n){for(var r=[],o=0;o<t.grid().rows();o++){for(var i=[],a=0;a<t.grid().columns();a++){var u=Me(t,o,a).map(function(t){return Z.elementnew(t.element(),n)}).getOrThunk(function(){return Z.elementnew(e.gap(),!0)});i.push(u)}var c=Z.rowcells(i,t.all()[o].section());r.push(c)}return r},wo=function(t,e,n,r){n===r?ue.remove(t,e):ue.set(t,e,n)},yo=function(t,e){for(var n=[],r=t;r<e;r++)n.push(r);return n},xo=function(e,n){if(n<0||n>=e.length-1)return W.none();var t=e[n].fold(function(){var t=q.reverse(e.slice(0,n));return io(t,function(t,e){return t.map(function(t){return{value:t,delta:e+1}})})},function(t){return W.some({value:t,delta:0})}),r=e[n+1].fold(function(){var t=e.slice(n+1);return io(t,function(t,e){return t.map(function(t){return{value:t,delta:e+1}})})},function(t){return W.some({value:t,delta:1})});return t.bind(function(n){return r.map(function(t){var e=t.delta+n.delta;return Math.abs(t.value-n.value)/e})})},Co=function(t,e,n){var r=t();return q.find(r,e).orThunk(function(){return W.from(r[0]).orThunk(n)}).map(function(t){return t.element()})},Ro=function(n){var t=n.grid(),e=yo(0,t.columns()),r=yo(0,t.rows());return q.map(e,function(e){return Co(function(){return q.bind(r,function(t){return Me(n,t,e).filter(function(t){return t.column()===e}).fold(M.constant([]),function(t){return[t]})})},function(t){return 1===t.colspan()},function(){return Me(n,0,e)})})},So=function(n){var t=n.grid(),e=yo(0,t.rows()),r=yo(0,t.columns());return q.map(e,function(e){return Co(function(){return q.bind(r,function(t){return Me(n,e,t).filter(function(t){return t.row()===e}).fold(M.constant([]),function(t){return[t]})})},function(t){return 1===t.rowspan()},function(){return Me(n,e,0)})})},To=function(t){var e=t.replace(/\./g,"-");return{resolve:function(t){return e+"-"+t}}},Do={resolve:To("ephox-snooker").resolve},ko=function(t,e){var n=ue.get(t,e);return void 0===n||""===n?[]:n.split(" ")},Ao=function(t,e){return o=e,i=ko(n=t,r="class").concat([o]),void ue.set(n,r,i.join(" "));var n,r,o,i},No=Ao,Oo=function(t){return void 0!==t.dom().classList},Io=function(t,e){return Oo(t)&&t.dom().classList.contains(e)},Po=function(t,e){Oo(t)?t.dom().classList.add(e):No(t,e)},Bo=Io,Eo=Do.resolve("resizer-bar"),Mo=Do.resolve("resizer-rows"),Wo=Do.resolve("resizer-cols"),jo=function(t){var e=me.descendants(t.parent(),"."+Eo);q.each(e,Ze.remove)},qo=function(n,t,r){var o=n.origin();q.each(t,function(t,e){t.each(function(t){var e=r(o,t);Po(e,Eo),Je.append(n.parent(),e)})})},Ho=function(t,e,n,r,o,i){var a,u,l,s,c,f,d,m,g=Cr(e);a=t,u=0<n.length?o.positions(n,e):[],l=g,s=ur(e),qo(a,u,function(t,e){var n,r,o,i,a,u,c=(n=e.row(),r=l.left()-t.left(),o=e.y()-t.top(),i=s,a=7,u=Q.fromTag("div"),Ue.setAll(u,{position:"absolute",left:r+"px",top:o-a/2+"px",height:a+"px",width:i+"px"}),ue.setAll(u,{"data-row":n,role:"presentation"}),u);return Po(c,Mo),c}),c=t,f=0<r.length?i.positions(r,e):[],d=g,m=or(e),qo(c,f,function(t,e){var n,r,o,i,a,u,c=(n=e.col(),r=e.x()-t.left(),o=d.top()-t.top(),i=7,a=m,u=Q.fromTag("div"),Ue.setAll(u,{position:"absolute",left:r-i/2+"px",top:o+"px",height:a+"px",width:i+"px"}),ue.setAll(u,{"data-column":n,role:"presentation"}),u);return Po(c,Wo),c})},Lo=function(t,e){var n=me.descendants(t.parent(),"."+Eo);q.each(n,e)},zo=function(t,e,n,r){jo(t);var o=Ie(e),i=Ee(o),a=So(i),u=Ro(i);Ho(t,e,a,u,n,r)},_o=function(t){Lo(t,function(t){Ue.set(t,"display","none")})},Fo=function(t){Lo(t,function(t){Ue.set(t,"display","block")})},Vo=jo,Uo=function(t){return Bo(t,Mo)},Go=function(t){return Bo(t,Wo)},Yo=function(t,e){var n,r,o=vo(t,Ht.eq);return n=o,r=e,q.map(n,function(t){var e,n=(e=t.details(),io(e,function(t){return Yt.parent(t.element()).map(function(t){var e=Yt.parent(t).isNone();return Z.elementnew(t,e)})}).getOrThunk(function(){return Z.elementnew(r.row(),!0)}));return Z.rowdatanew(n.element(),t.details(),t.section(),n.isNew())})},Jo=function(t,e){var n=q.flatten(q.map(t.all(),function(t){return t.cells()}));return q.find(n,function(t){return Ht.eq(e,t.element())})},Xo=function(a,n,m,g,u){return function(s,f,t,o,d){var e=Ie(f),i=Ee(e);return n(i,t).map(function(t){var e=bo(i,o,!1),n=a(e,t,Ht.eq,u(o)),r=Yo(n.grid(),o);return{grid:M.constant(r),cursor:n.cursor}}).fold(function(){return W.none()},function(t){var o,e,i,a,n,r,u,c,l=(o=f,e=t.grid(),i=[],a=[],n=function(t,e){0<t.length?function(t,e){var n=Se.child(o,e).getOrThunk(function(){var t=Q.fromTag(e,Yt.owner(o).dom());return Je.append(o,t),t});Ze.empty(n);var r=q.map(t,function(t){t.isNew()&&i.push(t.element());var e=t.element();return Ze.empty(e),q.each(t.cells(),function(t){t.isNew()&&a.push(t.element()),wo(t.element(),"colspan",t.colspan(),1),wo(t.element(),"rowspan",t.rowspan(),1),Je.append(e,t.element())}),e});Xe.append(n,r)}(t,e):Se.child(o,e).bind(Ze.remove)},r=[],u=[],c=[],q.each(e,function(t){switch(t.section()){case"thead":r.push(t);break;case"tbody":u.push(t);break;case"tfoot":c.push(t)}}),n(r,"thead"),n(u,"tbody"),n(c,"tfoot"),{newRows:M.constant(i),newCells:M.constant(a)});return m(f,t.grid(),d),g(f),zo(s,f,Br.height,d),W.some({cursor:t.cursor,newRows:l.newRows,newCells:l.newCells})})}},Ko=Yo,Zo=function(e,t){return ke(t.element()).bind(function(t){return Jo(e,t)})},$o=function(e,t){var n=q.map(t.selection(),function(t){return ke(t).bind(function(t){return Jo(e,t)})}),r=oo(n);return 0<r.length?W.some(r):W.none()},Qo=function(e,t){var n=q.map(t.selection(),function(t){return ke(t).bind(function(t){return Jo(e,t)})}),r=oo(n);return 0<r.length?W.some(ro.merge({cells:r},{generators:t.generators,clipboard:t.clipboard})):W.none()},ti=function(n){return{is:function(t){return n===t},isValue:M.always,isError:M.never,getOr:M.constant(n),getOrThunk:M.constant(n),getOrDie:M.constant(n),or:function(t){return ti(n)},orThunk:function(t){return ti(n)},fold:function(t,e){return e(n)},map:function(t){return ti(t(n))},each:function(t){t(n)},bind:function(t){return t(n)},exists:function(t){return t(n)},forall:function(t){return t(n)},toOption:function(){return W.some(n)}}},ei=function(n){return{is:M.never,isValue:M.never,isError:M.always,getOr:M.identity,getOrThunk:function(t){return t()},getOrDie:function(){return M.die(String(n))()},or:function(t){return t},orThunk:function(t){return t()},fold:function(t,e){return t(n)},map:function(t){return ei(n)},each:M.noop,bind:function(t){return ei(n)},exists:M.never,forall:M.always,toOption:W.none}},ni={value:ti,error:ei},ri=function(t,e){return q.map(t,function(){return Z.elementnew(e.cell(),!0)})},oi=function(t,e,n){return q.map(t,function(t){return lo(t,t.cells().concat(ri(yo(0,e),n)))})},ii=function(t,e){var n=po(t[0]),r=po(e[0]);return{rowDelta:M.constant(0),colDelta:M.constant(n-r)}},ai=function(t,e,n){var r=e.colDelta()<0?oi:M.identity;return(e.rowDelta()<0?function(e,t,n){return e.concat(function(t,e){for(var n=[],r=0;r<t;r++)n.push(e(r));return n}(t,function(t){return lo(e[e.length-1],ri(e[e.length-1].cells(),n))}))}:M.identity)(r(t,Math.abs(e.colDelta()),n),Math.abs(e.rowDelta()),n)},ui=function(t,e,n,r){for(var o=!0,i=0;i<t.length;i++)for(var a=0;a<po(t[0]);a++){var u=n(mo(t[i],a),e);!0===u&&!1===o?so(t[i],a,Z.elementnew(r(),!0)):!0===u&&(o=!1)}return t},ci=function(n,r,o,i,a){return function(t,e,n){if(t.row()>=e.length||t.column()>po(e[0]))return ni.error("invalid start address out of table bounds, row: "+t.row()+", column: "+t.column());var r=e.slice(t.row()),o=r[0].cells().slice(t.column()),i=po(n[0]),a=n.length;return ni.value({rowDelta:M.constant(r.length-a),colDelta:M.constant(o.length-i)})}(n,r,o).map(function(t){var e=ai(r,t,i);return function(t,e,n,r,o){for(var i,a,u,c,l,s,f,d=t.row(),m=t.column(),g=d+n.length,p=m+po(n[0]),h=d;h<g;h++)for(var v=m;v<p;v++){u=v,c=o,s=l=void 0,l=fo((i=e)[a=h],u),s=M.curry(c,l.element()),f=i[a],1<i.length&&1<po(f)&&(0<u&&s(mo(f,u-1))||u<f.length-1&&s(mo(f,u+1))||0<a&&s(mo(i[a-1],u))||a<i.length-1&&s(mo(i[a+1],u)))&&ui(e,mo(e[h],v),o,r.cell);var b=mo(n[h-d],v-m),w=r.replace(b);so(e[h],v,Z.elementnew(w,!0))}return e}(n,e,o,i,a)})},li=function(t,e,n,r,o){!function(i,a,u,c){if(0<a&&a<i.length){var t=(e=i[a-1].cells(),n=u,q.foldl(e,function(t,e){return q.exists(t,function(t){return n(t.element(),e.element())})?t:t.concat([e])},[]));q.each(t,function(t){for(var e=W.none(),n=a;n<i.length;n++)for(var r=0;r<po(i[0]);r++){var o=i[n].cells()[r];u(o.element(),t.element())&&(e.isNone()&&(e=W.some(c())),e.each(function(t){so(i[n],r,Z.elementnew(t,!0))}))}})}var e,n}(e,t,o,r.cell);var i=ii(n,e),a=ai(n,i,r),u=ii(e,a),c=ai(e,u,r);return c.slice(0,t).concat(a).concat(c.slice(t,c.length))},si=function(n,r,t,o,i){var e=n.slice(0,r),a=n.slice(r),u=go(n[t],function(t,e){return 0<r&&r<n.length&&o(mo(n[r-1],e),mo(n[r],e))?fo(n[r],e):Z.elementnew(i(t.element(),o),!0)});return e.concat([u]).concat(a)},fi=function(t,n,r,o,i){return q.map(t,function(t){var e=0<n&&n<po(t)&&o(mo(t,n-1),mo(t,n))?fo(t,n):Z.elementnew(i(mo(t,r),o),!0);return co(t,n,e)})},di=function(t,n,r,o){return q.map(t,function(t){return go(t,function(t){return e=t,q.exists(n,function(t){return r(e.element(),t.element())})?Z.elementnew(o(t.element(),r),!0):t;var e})})},mi=function(t,e,n,r){return void 0!==mo(t[e],n)&&0<e&&r(mo(t[e-1],n),mo(t[e],n))},gi=function(t,e,n){return 0<e&&n(mo(t,e-1),mo(t,e))},pi=function(n,r,o,t){var e=q.bind(n,function(t,e){return mi(n,e,r,o)||gi(t,r,o)?[]:[fo(t,r)]});return di(n,e,o,t)},hi=function(n,r,o,t){var i=n[r],e=q.bind(i.cells(),function(t,e){return mi(n,r,e,o)||gi(i,e,o)?[]:[t]});return di(n,e,o,t)},vi=function(t){return{fold:t}},bi=function(){return vi(function(t,e,n,r,o){return t()})},wi=function(t,e,i,a){var n,r,u,c,l,s,f,d,m,g,p=t.slice(0),o=(r=e,0===(n=t).length?bi():1===n.length?(g=0,vi(function(t,e,n,r,o){return e(g)})):0===r?(d=0,m=1,vi(function(t,e,n,r,o){return n(d,m)})):r===n.length-1?(s=r-1,f=r,vi(function(t,e,n,r,o){return o(s,f)})):0<r&&r<n.length-1?(u=r-1,l=(c=r)+1,vi(function(t,e,n,r,o){return r(u,c,l)})):bi()),h=function(t){return q.map(t,M.constant(0))},v=M.constant(h(p)),b=function(t,e){if(0<=i){var n=Math.max(a.minCellWidth(),p[e]-i);return h(p.slice(0,t)).concat([i,n-p[e]]).concat(h(p.slice(e+1)))}var r=Math.max(a.minCellWidth(),p[t]+i),o=p[t]-r;return h(p.slice(0,t)).concat([r-p[t],o]).concat(h(p.slice(e+1)))},w=b;return o.fold(v,function(t){return a.singleColumnWidth(p[t],i)},w,function(t,e,n){return b(e,n)},function(t,e){if(0<=i)return h(p.slice(0,e)).concat([i]);var n=Math.max(a.minCellWidth(),p[e]+i);return h(p.slice(0,e)).concat([n-p[e]])})},yi=function(t,e){return ue.has(t,e)&&1<parseInt(ue.get(t,e),10)},xi={hasColspan:function(t){return yi(t,"colspan")},hasRowspan:function(t){return yi(t,"rowspan")},minWidth:M.constant(10),minHeight:M.constant(10),getInt:function(t,e){return parseInt(Ue.get(t,e),10)}},Ci=function(t,e,n){return Ue.getRaw(t,e).fold(function(){return n(t)+"px"},function(t){return t})},Ri=function(t){return Ci(t,"width",vr.getPixelWidth)},Si=function(t){return Ci(t,"height",vr.getHeight)},Ti=function(t,e,n,r,o){var i=Ro(t),a=q.map(i,function(t){return t.map(e.edge)});return q.map(i,function(t,e){return t.filter(M.not(xi.hasColspan)).fold(function(){var t=xo(a,e);return r(t)},function(t){return n(t,o)})})},Di=function(t){return t.map(function(t){return t+"px"}).getOr("")},ki=function(t,e,n,r){var o=So(t),i=q.map(o,function(t){return t.map(e.edge)});return q.map(o,function(t,e){return t.filter(M.not(xi.hasRowspan)).fold(function(){var t=xo(i,e);return r(t)},function(t){return n(t)})})},Ai={getRawWidths:function(t,e){return Ti(t,e,Ri,Di)},getPixelWidths:function(t,e,n){return Ti(t,e,vr.getPixelWidth,function(t){return t.getOrThunk(n.minCellWidth)},n)},getPercentageWidths:function(t,e,n){return Ti(t,e,vr.getPercentageWidth,function(t){return t.fold(function(){return n.minCellWidth()},function(t){return t/n.pixelWidth()*100})},n)},getPixelHeights:function(t,e){return ki(t,e,vr.getHeight,function(t){return t.getOrThunk(xi.minHeight)})},getRawHeights:function(t,e){return ki(t,e,Si,Di)}},Ni=function(t,e,n){for(var r=0,o=t;o<e;o++)r+=void 0!==n[o]?n[o]:0;return r},Oi=function(t,n){var e=qe(t);return q.map(e,function(t){var e=Ni(t.column(),t.column()+t.colspan(),n);return{element:t.element,width:M.constant(e),colspan:t.colspan}})},Ii=function(t){var e=parseInt(t,10),n=M.identity;return{width:M.constant(e),pixelWidth:M.constant(e),getWidths:Ai.getPixelWidths,getCellDelta:n,singleColumnWidth:function(t,e){return[Math.max(xi.minWidth(),t+e)-t]},minCellWidth:xi.minWidth,setElementWidth:vr.setPixelWidth,setTableWidth:function(t,e,n){var r=q.foldr(e,function(t,e){return t+e},0);vr.setPixelWidth(t,r)}}},Pi=function(e){return vr.getRawWidth(e).fold(function(){var t=ar(e);return Ii(t)},function(t){return function(t,e){if(vr.percentageBasedSizeRegex().test(e))return r=vr.percentageBasedSizeRegex().exec(e)[1],o=t,i=parseFloat(r),a=ar(o),{width:M.constant(i),pixelWidth:M.constant(a),getWidths:Ai.getPercentageWidths,getCellDelta:function(t){return t/a*100},singleColumnWidth:function(t,e){return[100-t]},minCellWidth:function(){return xi.minWidth()/a*100},setElementWidth:vr.setPercentageWidth,setTableWidth:function(t,e,n){var r=i+n;vr.setPercentageWidth(t,r)}};if(vr.pixelBasedSizeRegex().test(e)){var n=vr.pixelBasedSizeRegex().exec(e);return Ii(n[1])}var r,o,i,a,u=ar(t);return Ii(u)}(e,t)})},Bi=function(t){return Ee(t)},Ei=function(t){var e=Ie(t);return Bi(e)},Mi=function(t,n,r,e){var o,i,a,u,c=Ei(t),l=Ai.getPixelHeights(c,e),s=q.map(l,function(t,e){return r===e?Math.max(n+t,xi.minHeight()):t}),f=(a=s,u=qe(c),q.map(u,function(t){var e=Ni(t.row(),t.row()+t.rowspan(),a);return{element:t.element,height:M.constant(e),rowspan:t.rowspan}})),d=(o=c,i=s,q.map(o.all(),function(t,e){return{element:t.element,height:M.constant(i[e])}}));q.each(d,function(t){vr.setHeight(t.element(),t.height())}),q.each(f,function(t){vr.setHeight(t.element(),t.height())});var m,g=(m=s,q.foldr(m,function(t,e){return t+e},0));vr.setHeight(t,g)},Wi=function(t){0===Ae(t).length&&Ze.remove(t)},ji=V.immutable("grid","cursor"),qi=function(t,e,n){return Hi(t,e,n).orThunk(function(){return Hi(t,0,0)})},Hi=function(t,e,n){return W.from(t[e]).bind(function(t){return W.from(t.cells()[n]).bind(function(t){return W.from(t.element())})})},Li=function(t,e,n){return ji(t,Hi(t,e,n))},zi=function(t){return q.foldl(t,function(t,e){return q.exists(t,function(t){return t.row()===e.row()})?t:t.concat([e])},[]).sort(function(t,e){return t.row()-e.row()})},_i=function(t){return q.foldl(t,function(t,e){return q.exists(t,function(t){return t.column()===e.column()})?t:t.concat([e])},[]).sort(function(t,e){return t.column()-e.column()})},Fi=function(t,e,n){var r,o,i=(r=t,o=n,q.map(r,function(t){var e=q.map(Ae(t),function(t){var e=ue.has(t,"rowspan")?parseInt(ue.get(t,"rowspan"),10):1,n=ue.has(t,"colspan")?parseInt(ue.get(t,"colspan"),10):1;return Z.detail(t,e,n)});return Z.rowdata(t,e,o.section())})),a=Ee(i);return bo(a,e,!0)},Vi=function(t,e,n){var r=Pi(t),o=Bi(e),i=r.getWidths(o,n,r),a=Oi(o,i);q.each(a,function(t){r.setElementWidth(t.element(),t.width())});var u=q.foldr(i,function(t,e){return e+t},0);0<a.length&&r.setElementWidth(t,u)},Ui={insertRowBefore:Xo(function(t,e,n,r){var o=e.row(),i=e.row(),a=si(t,i,o,n,r.getOrInit);return Li(a,i,e.column())},Zo,M.noop,M.noop,Vr),insertRowsBefore:Xo(function(t,e,n,r){var o=e[0].row(),i=e[0].row(),a=zi(e),u=q.foldl(a,function(t,e){return si(t,i,o,n,r.getOrInit)},t);return Li(u,i,e[0].column())},$o,M.noop,M.noop,Vr),insertRowAfter:Xo(function(t,e,n,r){var o=e.row(),i=e.row()+e.rowspan(),a=si(t,i,o,n,r.getOrInit);return Li(a,i,e.column())},Zo,M.noop,M.noop,Vr),insertRowsAfter:Xo(function(t,e,n,r){var o=zi(e),i=o[o.length-1].row(),a=o[o.length-1].row()+o[o.length-1].rowspan(),u=q.foldl(o,function(t,e){return si(t,a,i,n,r.getOrInit)},t);return Li(u,a,e[0].column())},$o,M.noop,M.noop,Vr),insertColumnBefore:Xo(function(t,e,n,r){var o=e.column(),i=e.column(),a=fi(t,i,o,n,r.getOrInit);return Li(a,e.row(),i)},Zo,Vi,M.noop,Vr),insertColumnsBefore:Xo(function(t,e,n,r){var o=_i(e),i=o[0].column(),a=o[0].column(),u=q.foldl(o,function(t,e){return fi(t,a,i,n,r.getOrInit)},t);return Li(u,e[0].row(),a)},$o,Vi,M.noop,Vr),insertColumnAfter:Xo(function(t,e,n,r){var o=e.column(),i=e.column()+e.colspan(),a=fi(t,i,o,n,r.getOrInit);return Li(a,e.row(),i)},Zo,Vi,M.noop,Vr),insertColumnsAfter:Xo(function(t,e,n,r){var o=e[e.length-1].column(),i=e[e.length-1].column()+e[e.length-1].colspan(),a=_i(e),u=q.foldl(a,function(t,e){return fi(t,i,o,n,r.getOrInit)},t);return Li(u,e[0].row(),i)},$o,Vi,M.noop,Vr),splitCellIntoColumns:Xo(function(t,e,n,r){var o,i,a,u,c,l,s=(o=t,i=e.row(),a=e.column(),u=n,c=r.getOrInit,l=a+1,q.map(o,function(t,e){var n=e===i?Z.elementnew(c(mo(t,a),u),!0):fo(t,a);return co(t,l,n)}));return Li(s,e.row(),e.column())},Zo,Vi,M.noop,Vr),splitCellIntoRows:Xo(function(t,e,n,r){var o,i,a,u,c,l,s,f,d,m=(o=t,i=e.row(),a=e.column(),u=n,c=r.getOrInit,l=i+1,s=o.slice(0,l),f=o.slice(l),d=go(o[i],function(t,e){return e===a?Z.elementnew(c(t.element(),u),!0):t}),s.concat([d]).concat(f));return Li(m,e.row(),e.column())},Zo,M.noop,M.noop,Vr),eraseColumns:Xo(function(t,e,n,r){var o,i,a,u,c=_i(e),l=(o=t,i=c[0].column(),a=c[c.length-1].column(),u=q.map(o,function(t){var e=t.cells().slice(0,i).concat(t.cells().slice(a+1));return Z.rowcells(e,t.section())}),q.filter(u,function(t){return 0<t.cells().length})),s=qi(l,e[0].row(),e[0].column());return ji(l,s)},$o,Vi,Wi,Vr),eraseRows:Xo(function(t,e,n,r){var o,i,a,u=zi(e),c=(o=t,i=u[0].row(),a=u[u.length-1].row(),o.slice(0,i).concat(o.slice(a+1))),l=qi(c,e[0].row(),e[0].column());return ji(c,l)},$o,M.noop,Wi,Vr),makeColumnHeader:Xo(function(t,e,n,r){var o=pi(t,e.column(),n,r.replaceOrInit);return Li(o,e.row(),e.column())},Zo,M.noop,M.noop,Ur("row","th")),unmakeColumnHeader:Xo(function(t,e,n,r){var o=pi(t,e.column(),n,r.replaceOrInit);return Li(o,e.row(),e.column())},Zo,M.noop,M.noop,Ur(null,"td")),makeRowHeader:Xo(function(t,e,n,r){var o=hi(t,e.row(),n,r.replaceOrInit);return Li(o,e.row(),e.column())},Zo,M.noop,M.noop,Ur("col","th")),unmakeRowHeader:Xo(function(t,e,n,r){var o=hi(t,e.row(),n,r.replaceOrInit);return Li(o,e.row(),e.column())},Zo,M.noop,M.noop,Ur(null,"td")),mergeCells:Xo(function(t,e,n,r){var o=e.cells();Qr(o);var i=function(t,e,n,r){if(0===t.length)return t;for(var o=e.startRow();o<=e.finishRow();o++)for(var i=e.startCol();i<=e.finishCol();i++)so(t[o],i,Z.elementnew(r(),!1));return t}(t,e.bounds(),0,M.constant(o[0]));return ji(i,W.from(o[0]))},function(t,e){return e.mergable()},M.noop,M.noop,Gr),unmergeCells:Xo(function(t,e,n,r){var o=q.foldr(e,function(t,e){return ui(t,e,n,r.combine(e))},t);return ji(o,W.from(e[0]))},function(t,e){return e.unmergable()},Vi,M.noop,Gr),pasteCells:Xo(function(t,n,e,r){var o,i,a,u,c=(o=n.clipboard(),i=n.generators(),a=Ie(o),u=Ee(a),bo(u,i,!0)),l=Z.address(n.row(),n.column());return ci(l,t,c,n.generators(),e).fold(function(){return ji(t,W.some(n.element()))},function(t){var e=qi(t,n.row(),n.column());return ji(t,e)})},function(e,n){return ke(n.element()).bind(function(t){return Jo(e,t).map(function(t){return ro.merge(t,{generators:n.generators,clipboard:n.clipboard})})})},Vi,M.noop,Vr),pasteRowsBefore:Xo(function(t,e,n,r){var o=t[e.cells[0].row()],i=e.cells[0].row(),a=Fi(e.clipboard(),e.generators(),o),u=li(i,t,a,e.generators(),n),c=qi(u,e.cells[0].row(),e.cells[0].column());return ji(u,c)},Qo,M.noop,M.noop,Vr),pasteRowsAfter:Xo(function(t,e,n,r){var o=t[e.cells[0].row()],i=e.cells[e.cells.length-1].row()+e.cells[e.cells.length-1].rowspan(),a=Fi(e.clipboard(),e.generators(),o),u=li(i,t,a,e.generators(),n),c=qi(u,e.cells[0].row(),e.cells[0].column());return ji(u,c)},Qo,M.noop,M.noop,Vr)},Gi=function(t){return Q.fromDom(t.getBody())},Yi=function(t){return t.getBoundingClientRect().width},Ji=function(t){return t.getBoundingClientRect().height},Xi=function(e){return function(t){return Ht.eq(t,Gi(e))}},Ki=function(t){return/^[0-9]+$/.test(t)&&(t+="px"),t},Zi=function(t){var e=me.descendants(t,"td[data-mce-style],th[data-mce-style]");ue.remove(t,"data-mce-style"),q.each(e,function(t){ue.remove(t,"data-mce-style")})},$i=function(t){return"rtl"===Ue.get(t,"direction")?"rtl":"ltr"},Qi=$i,ta={isRtl:M.constant(!1)},ea={isRtl:M.constant(!0)},na=function(t){return"rtl"===Qi(t)?ea:ta},ra=["tableprops","tabledelete","|","tableinsertrowbefore","tableinsertrowafter","tabledeleterow","|","tableinsertcolbefore","tableinsertcolafter","tabledeletecol"],oa={"border-collapse":"collapse",width:"100%"},ia={border:"1"},aa=function(t){return t.getParam("table_cell_advtab",!0,"boolean")},ua=function(t){return t.getParam("table_row_advtab",!0,"boolean")},ca=function(t){return t.getParam("table_advtab",!0,"boolean")},la=function(t){return t.getParam("table_style_by_css",!1,"boolean")},sa=function(t){return t.getParam("table_cell_class_list",[],"array")},fa=function(t){return t.getParam("table_row_class_list",[],"array")},da=function(t){return t.getParam("table_class_list",[],"array")},ma=function(t){return!1===t.getParam("table_responsive_width")},ga=function(t,e){return t.fire("newrow",{node:e})},pa=function(t,e){return t.fire("newcell",{node:e})},ha=function(t,e,n,r){t.fire("ObjectResizeStart",{target:e,width:n,height:r})},va=function(t,e,n,r){t.fire("ObjectResized",{target:e,width:n,height:r})},ba=function(t,e,o){var n=Ie(t),i=Ee(n);return $o(i,e).map(function(t){var e,n=bo(i,o,!1).slice(t[0].row(),t[t.length-1].row()+t[t.length-1].rowspan()),r=Ko(n,o);return e=r,q.map(e,function(t){var n=en(t.element());return q.each(t.cells(),function(t){var e=nn(t.element());wo(e,"colspan",t.colspan(),1),wo(e,"rowspan",t.rowspan(),1),Je.append(n,e)}),n})})},wa=tinymce.util.Tools.resolve("tinymce.util.Tools"),ya=function(t,e,n){n&&t.formatter.apply("align"+n,{},e)},xa=function(e,n){wa.each("left center right".split(" "),function(t){e.formatter.remove("align"+t,{},n)})},Ca=function(o,t,i){var e;return function(t,e){for(var n=0;n<e.length;n++){var r=o.getStyle(e[n],i);if(void 0===t&&(t=r),t!==r)return""}return t}(e,o.select("td,th",t))},Ra=function(t,e){var n=t.dom,r=e.control.rootControl,o=r.toJSON(),i=n.parseStyle(o.style);"style"===e.control.name()?(r.find("#borderStyle").value(i["border-style"]||"")[0].fire("select"),r.find("#borderColor").value(i["border-color"]||"")[0].fire("change"),r.find("#backgroundColor").value(i["background-color"]||"")[0].fire("change"),r.find("#width").value(i.width||"").fire("change"),r.find("#height").value(i.height||"").fire("change")):(i["border-style"]=o.borderStyle,i["border-color"]=o.borderColor,i["background-color"]=o.backgroundColor,i.width=o.width?Ki(o.width):"",i.height=o.height?Ki(o.height):""),r.find("#style").value(n.serializeStyle(n.parseStyle(n.serializeStyle(i))))},Sa=function(n){var t=function(){var t=n.getParam("color_picker_callback");if(t)return function(e){return t.call(n,function(t){e.control.value(t).fire("change")},e.control.value())}};return{title:"Advanced",type:"form",defaults:{onchange:M.curry(Ra,n)},items:[{label:"Style",name:"style",type:"textbox"},{type:"form",padding:0,formItemDefaults:{layout:"grid",alignH:["start","right"]},defaults:{size:7},items:[{label:"Border style",type:"listbox",name:"borderStyle",width:90,onselect:M.curry(Ra,n),values:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]},{label:"Border color",type:"colorbox",name:"borderColor",onaction:t()},{label:"Background color",type:"colorbox",name:"backgroundColor",onaction:t()}]}]}},Ta=function(t,r,e){var o=function(t,n){return n=n||[],wa.each(t,function(t){var e={text:t.text||t.title};t.menu?e.menu=o(t.menu):(e.value=t.value,r&&r(e)),n.push(e)}),n};return o(t,e||[])},Da=Ra,ka=function(t,e){var n=t.parseStyle(t.getAttrib(e,"style")),r={};return n["border-style"]&&(r.borderStyle=n["border-style"]),n["border-color"]&&(r.borderColor=n["border-color"]),n["background-color"]&&(r.backgroundColor=n["background-color"]),r.style=t.serializeStyle(n),r},Aa=function(c,l,t){var s,f=c.dom;function d(t,e,n){n&&f.setAttrib(t,e,n)}function m(t,e,n){n&&f.setStyle(t,e,n)}Da(c,t),s=t.control.rootControl.toJSON(),c.undoManager.transact(function(){wa.each(l,function(t){var e,n,r,o,i,a,u;d(t,"scope",s.scope),1===l.length?d(t,"style",s.style):(e=t,n=s.style,delete e.dataset.mceStyle,e.style.cssText+=";"+n),d(t,"class",s.class),m(t,"width",Ki(s.width)),m(t,"height",Ki(s.height)),s.type&&t.nodeName.toLowerCase()!==s.type&&(t=f.rename(t,s.type)),1===l.length&&(xa(c,t),a=c,u=t,wa.each("top middle bottom".split(" "),function(t){a.formatter.remove("valign"+t,{},u)})),s.align&&ya(c,t,s.align),s.valign&&(r=c,o=t,(i=s.valign)&&r.formatter.apply("valign"+i,{},o))}),c.focus()})},Na=function(e){var t,n,r,o=[];if(o=e.dom.select("td[data-mce-selected],th[data-mce-selected]"),t=e.dom.getParent(e.selection.getStart(),"td,th"),!o.length&&t&&o.push(t),t=t||o[0]){var i,a,u,c;1<o.length?n={width:"",height:"",scope:"",class:"",align:"",valign:"",style:"",type:t.nodeName.toLowerCase()}:(a=t,u=(i=e).dom,c={width:u.getStyle(a,"width")||u.getAttrib(a,"width"),height:u.getStyle(a,"height")||u.getAttrib(a,"height"),scope:u.getAttrib(a,"scope"),class:u.getAttrib(a,"class"),type:a.nodeName.toLowerCase(),style:"",align:"",valign:""},wa.each("left center right".split(" "),function(t){i.formatter.matchNode(a,"align"+t)&&(c.align=t)}),wa.each("top middle bottom".split(" "),function(t){i.formatter.matchNode(a,"valign"+t)&&(c.valign=t)}),aa(i)&&wa.extend(c,ka(u,a)),n=c),0<sa(e).length&&(r={name:"class",type:"listbox",label:"Class",values:Ta(sa(e),function(t){t.value&&(t.textStyle=function(){return e.formatter.getCssText({block:"td",classes:[t.value]})})})});var l={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,items:[{type:"form",layout:"grid",columns:2,labelGapCalc:!1,padding:0,defaults:{type:"textbox",maxWidth:50},items:[{label:"Width",name:"width",onchange:M.curry(Da,e)},{label:"Height",name:"height",onchange:M.curry(Da,e)},{label:"Cell type",name:"type",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{label:"Scope",name:"scope",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{label:"H Align",name:"align",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"V Align",name:"valign",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Top",value:"top"},{text:"Middle",value:"middle"},{text:"Bottom",value:"bottom"}]}]},r]};aa(e)?e.windowManager.open({title:"Cell properties",bodyType:"tabpanel",data:n,body:[{title:"General",type:"form",items:l},Sa(e)],onsubmit:M.curry(Aa,e,o)}):e.windowManager.open({title:"Cell properties",data:n,body:l,onsubmit:M.curry(Aa,e,o)})}};function Oa(l,t,s,e){var f=l.dom;function d(t,e,n){n&&f.setAttrib(t,e,n)}Da(l,e);var m=e.control.rootControl.toJSON();l.undoManager.transact(function(){wa.each(t,function(t){var e,n,r,o,i,a,u,c;d(t,"scope",m.scope),d(t,"style",m.style),d(t,"class",m.class),e=t,(n=Ki(m.height))&&f.setStyle(e,"height",n),m.type!==t.parentNode.nodeName.toLowerCase()&&(r=l.dom,o=t,i=m.type,a=r.getParent(o,"table"),u=o.parentNode,(c=r.select(i,a)[0])||(c=r.create(i),a.firstChild?"CAPTION"===a.firstChild.nodeName?r.insertAfter(c,a.firstChild):a.insertBefore(c,a.firstChild):a.appendChild(c)),c.appendChild(o),u.hasChildNodes()||r.remove(u)),m.align!==s.align&&(xa(l,t),ya(l,t,m.align))}),l.focus()})}var Ia=function(e){var t,n,r,o,i,a,u,c,l,s,f=e.dom,d=[];t=f.getParent(e.selection.getStart(),"table"),n=f.getParent(e.selection.getStart(),"td,th"),wa.each(t.rows,function(e){wa.each(e.cells,function(t){if(f.getAttrib(t,"data-mce-selected")||t===n)return d.push(e),!1})}),(r=d[0])&&(1<d.length?i={height:"",scope:"",style:"",class:"",align:"",type:r.parentNode.nodeName.toLowerCase()}:(c=r,l=(u=e).dom,s={height:l.getStyle(c,"height")||l.getAttrib(c,"height"),scope:l.getAttrib(c,"scope"),class:l.getAttrib(c,"class"),align:"",style:"",type:c.parentNode.nodeName.toLowerCase()},wa.each("left center right".split(" "),function(t){u.formatter.matchNode(c,"align"+t)&&(s.align=t)}),ua(u)&&wa.extend(s,ka(l,c)),i=s),0<fa(e).length&&(o={name:"class",type:"listbox",label:"Class",values:Ta(fa(e),function(t){t.value&&(t.textStyle=function(){return e.formatter.getCssText({block:"tr",classes:[t.value]})})})}),a={type:"form",columns:2,padding:0,defaults:{type:"textbox"},items:[{type:"listbox",name:"type",label:"Row type",text:"Header",maxWidth:null,values:[{text:"Header",value:"thead"},{text:"Body",value:"tbody"},{text:"Footer",value:"tfoot"}]},{type:"listbox",name:"align",label:"Alignment",text:"None",maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height"},o]},ua(e)?e.windowManager.open({title:"Row properties",data:i,bodyType:"tabpanel",body:[{title:"General",type:"form",items:a},Sa(e)],onsubmit:M.curry(Oa,e,d,i)}):e.windowManager.open({title:"Row properties",data:i,body:a,onsubmit:M.curry(Oa,e,d,i)}))},Pa=tinymce.util.Tools.resolve("tinymce.Env"),Ba={styles:{"border-collapse":"collapse",width:"100%"},attributes:{border:"1"},percentages:!0},Ea=function(t,e){t.selection.select(e.dom(),!0),t.selection.collapse(!0)},Ma=function(o,t,e){var n,r,i=o.getParam("table_default_styles",oa,"object"),a=function(t,e,n,r,o){void 0===o&&(o=Ba);var i=Q.fromTag("table");Ue.setAll(i,o.styles),ue.setAll(i,o.attributes);var a=Q.fromTag("tbody");Je.append(i,a);for(var u=[],c=0;c<t;c++){for(var l=Q.fromTag("tr"),s=0;s<e;s++){var f=Q.fromTag(c<n||s<r?"th":"td");s<r&&ue.set(f,"scope","row"),c<n&&ue.set(f,"scope","col"),Je.append(f,Q.fromTag("br")),o.percentages&&Ue.set(f,"width",100/e+"%"),Je.append(l,f)}u.push(l)}return Xe.append(a,u),i}(e,t,0,0,{styles:i,attributes:(r=o,r.getParam("table_default_attributes",ia,"object")),percentages:(n=i.width,j.isString(n)&&-1!==n.indexOf("%")&&!ma(o))});ue.set(a,"data-mce-id","__mce");var u,c,l,s=(u=a,c=Q.fromTag("div"),l=Q.fromDom(u.dom().cloneNode(!0)),Je.append(c,l),c.dom().innerHTML);return o.insertContent(s),Se.descendant(Gi(o),'table[data-mce-id="__mce"]').map(function(t){var e,n,r;return ma(o)&&Ue.set(t,"width",Ue.get(t,"width")),ue.remove(t,"data-mce-id"),e=o,n=t,q.each(me.descendants(n,"tr"),function(t){ga(e,t.dom()),q.each(me.descendants(t,"th,td"),function(t){pa(e,t.dom())})}),r=o,Se.descendant(t,"td,th").each(M.curry(Ea,r)),t.dom()}).getOr(null)};function Wa(t,e,n,r){if("TD"===e.tagName||"TH"===e.tagName)t.setStyle(e,n,r);else if(e.children)for(var o=0;o<e.children.length;o++)Wa(t,e.children[o],n,r)}var ja=function(t,e,n){var r,o,i=t.dom;Da(t,n),!1===(o=n.control.rootControl.toJSON()).class&&delete o.class,t.undoManager.transact(function(){e||(e=Ma(t,o.cols||1,o.rows||1)),function(t,e,n){var r,o=t.dom,i={},a={};if(i.class=n.class,a.height=Ki(n.height),o.getAttrib(e,"width")&&!la(t)?i.width=(r=n.width)?r.replace(/px$/,""):"":a.width=Ki(n.width),la(t)?(a["border-width"]=Ki(n.border),a["border-spacing"]=Ki(n.cellspacing),wa.extend(i,{"data-mce-border-color":n.borderColor,"data-mce-cell-padding":n.cellpadding,"data-mce-border":n.border})):wa.extend(i,{border:n.border,cellpadding:n.cellpadding,cellspacing:n.cellspacing}),la(t)&&e.children)for(var u=0;u<e.children.length;u++)Wa(o,e.children[u],{"border-width":Ki(n.border),"border-color":n.borderColor,padding:Ki(n.cellpadding)});n.style?wa.extend(a,o.parseStyle(n.style)):a=wa.extend({},o.parseStyle(o.getAttrib(e,"style")),a),i.style=o.serializeStyle(a),o.setAttribs(e,i)}(t,e,o),(r=i.select("caption",e)[0])&&!o.caption&&i.remove(r),!r&&o.caption&&((r=i.create("caption")).innerHTML=Pa.ie?"Â ":'<br data-mce-bogus="1"/>',e.insertBefore(r,e.firstChild)),xa(t,e),o.align&&ya(t,e,o.align),t.focus(),t.addVisual()})},qa=function(e,t){var n,r,o,i,a,u,c,l,s,f,d=e.dom,m={};!0===t?(n=d.getParent(e.selection.getStart(),"table"))&&(c=n,l=(u=e).dom,s={width:l.getStyle(c,"width")||l.getAttrib(c,"width"),height:l.getStyle(c,"height")||l.getAttrib(c,"height"),cellspacing:l.getStyle(c,"border-spacing")||l.getAttrib(c,"cellspacing"),cellpadding:l.getAttrib(c,"data-mce-cell-padding")||l.getAttrib(c,"cellpadding")||Ca(u.dom,c,"padding"),border:l.getAttrib(c,"data-mce-border")||l.getAttrib(c,"border")||Ca(u.dom,c,"border"),borderColor:l.getAttrib(c,"data-mce-border-color"),caption:!!l.select("caption",c)[0],class:l.getAttrib(c,"class")},wa.each("left center right".split(" "),function(t){u.formatter.matchNode(c,"align"+t)&&(s.align=t)}),ca(u)&&wa.extend(s,ka(l,c)),m=s):(r={label:"Cols",name:"cols"},o={label:"Rows",name:"rows"}),0<da(e).length&&(m.class&&(m.class=m.class.replace(/\s*mce\-item\-table\s*/g,"")),i={name:"class",type:"listbox",label:"Class",values:Ta(da(e),function(t){t.value&&(t.textStyle=function(){return e.formatter.getCssText({block:"table",classes:[t.value]})})})}),a={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,items:[{type:"form",labelGapCalc:!1,padding:0,layout:"grid",columns:2,defaults:{type:"textbox",maxWidth:50},items:(f=e,f.getParam("table_appearance_options",!0,"boolean")?[r,o,{label:"Width",name:"width",onchange:M.curry(Da,e)},{label:"Height",name:"height",onchange:M.curry(Da,e)},{label:"Cell spacing",name:"cellspacing"},{label:"Cell padding",name:"cellpadding"},{label:"Border",name:"border"},{label:"Caption",name:"caption",type:"checkbox"}]:[r,o,{label:"Width",name:"width",onchange:M.curry(Da,e)},{label:"Height",name:"height",onchange:M.curry(Da,e)}])},{label:"Alignment",name:"align",type:"listbox",text:"None",values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},i]},ca(e)?e.windowManager.open({title:"Table properties",data:m,bodyType:"tabpanel",body:[{title:"General",type:"form",items:a},Sa(e)],onsubmit:M.curry(ja,e,n)}):e.windowManager.open({title:"Table properties",data:m,body:a,onsubmit:M.curry(ja,e,n)})},Ha=wa.each,La=function(t){var e=W.from(t.dom().documentElement).map(Q.fromDom).getOr(t);return{parent:M.constant(e),view:M.constant(t),origin:M.constant(wr(0,0))}};function za(t){var n=V.immutable.apply(null,t),r=[];return{bind:function(t){if(void 0===t)throw"Event bind error: undefined handler";r.push(t)},unbind:function(e){r=q.filter(r,function(t){return t!==e})},trigger:function(){var e=n.apply(null,arguments);q.each(r,function(t){t(e)})}}}var _a={create:function(t){return{registry:E.map(t,function(t){return{bind:t.bind,unbind:t.unbind}}),trigger:E.map(t,function(t){return t.trigger})}}},Fa={mode:zr.exactly(["compare","extract","mutate","sink"]),sink:zr.exactly(["element","start","stop","destroy"]),api:zr.exactly(["forceDrop","drop","move","delayDrop"])},Va={resolve:To("ephox-dragster").resolve},Ua=function(t,e,n,r,o){var m,g,i=(m=n,g=r,function(t){if(m(t)){var e,n,r,o,i,a,u,c=Q.fromDom(t.target),l=function(){t.stopPropagation()},s=function(){t.preventDefault()},f=M.compose(s,l),d=(e=c,n=t.clientX,r=t.clientY,o=l,i=s,a=f,u=t,{target:M.constant(e),x:M.constant(n),y:M.constant(r),stop:o,prevent:i,kill:a,raw:M.constant(u)});g(d)}});return t.dom().addEventListener(e,i,o),{unbind:M.curry(Ga,t,e,i,o)}},Ga=function(t,e,n,r){t.dom().removeEventListener(e,n,r)},Ya=M.constant(!0),Ja=function(t,e,n){return Ua(t,e,Ya,n,!1)},Xa=Fa.mode({compare:function(t,e){return wr(e.left()-t.left(),e.top()-t.top())},extract:function(t){return W.some(wr(t.x(),t.y()))},sink:function(t,e){var n,r,o,i=(n=e,r=ro.merge({layerClass:Va.resolve("blocker")},n),o=Q.fromTag("div"),ue.set(o,"role","presentation"),Ue.setAll(o,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"}),Po(o,Va.resolve("blocker")),Po(o,r.layerClass),{element:function(){return o},destroy:function(){Ze.remove(o)}}),a=Ja(i.element(),"mousedown",t.forceDrop),u=Ja(i.element(),"mouseup",t.drop),c=Ja(i.element(),"mousemove",t.move),l=Ja(i.element(),"mouseout",t.delayDrop);return Fa.sink({element:i.element,start:function(t){Je.append(t,i.element())},stop:function(){Ze.remove(i.element())},destroy:function(){i.destroy(),u.unbind(),c.unbind(),l.unbind(),a.unbind()}})},mutate:function(t,e){t.mutate(e.left(),e.top())}});function Ka(){var i,a,t={onEvent:function(t,e){},reset:M.noop},e=(i=W.none(),{onEvent:function(t,o){o.extract(t).each(function(t){var e,n,r;(e=o,n=t,r=i.map(function(t){return e.compare(t,n)}),i=W.some(n),r).each(function(t){a.trigger.move(t)})})},reset:function(){i=W.none()},events:(a=_a.create({move:za(["info"])})).registry}),n=t;return{on:function(){n.reset(),n=e},off:function(){n.reset(),n=t},isOn:function(){return n===e},onEvent:function(t,e){n.onEvent(t,e)},events:e.events}}var Za=function(e,n,t){var r,o,i,a=!1,u=_a.create({start:za([]),stop:za([])}),c=Ka(),l=function(){d.stop(),c.isOn()&&(c.off(),u.trigger.stop())},s=(r=l,o=200,i=null,{cancel:function(){null!==i&&(clearTimeout(i),i=null)},throttle:function(){var t=arguments;null!==i&&clearTimeout(i),i=setTimeout(function(){r.apply(null,t),t=i=null},o)}});c.events.move.bind(function(t){n.mutate(e,t.info())});var f=function(e){return function(){var t=Array.prototype.slice.call(arguments,0);if(a)return e.apply(null,t)}},d=n.sink(Fa.api({forceDrop:l,drop:f(l),move:f(function(t,e){s.cancel(),c.onEvent(t,n)}),delayDrop:f(s.throttle)}),t);return{element:d.element,go:function(t){d.start(t),c.on(),u.trigger.start()},on:function(){a=!0},off:function(){a=!1},destroy:function(){d.destroy()},events:u.registry}},$a=function(t,e){var n=void 0!==e?e:{},r=void 0!==n.mode?n.mode:Xa;return Za(t,r,e)};var Qa=function(t,e,n){return Se.closest(t,e,n).isSome()},tu=Do.resolve("resizer-bar-dragging");function eu(t,m){var n=Br.height,e=function(o,e,i){var n,r,a,t,u=(r=_a.create({drag:za(["xDelta","yDelta","target"])}),a=W.none(),(t={mutate:function(t,e){n.trigger.drag(t,e)},events:(n=_a.create({drag:za(["xDelta","yDelta"])})).registry}).events.drag.bind(function(e){a.each(function(t){r.trigger.drag(e.xDelta(),e.yDelta(),t)})}),{assign:function(t){a=W.some(t)},get:function(){return a},mutate:t.mutate,events:r.registry}),c=$a(u,{}),l=W.none(),s=function(t,e){return W.from(ue.get(t,e))};u.events.drag.bind(function(n){s(n.target(),"data-row").each(function(t){var e=xi.getInt(n.target(),"top");Ue.set(n.target(),"top",e+n.yDelta()+"px")}),s(n.target(),"data-column").each(function(t){var e=xi.getInt(n.target(),"left");Ue.set(n.target(),"left",e+n.xDelta()+"px")})});var f=function(t,e){return xi.getInt(t,e)-parseInt(ue.get(t,"data-initial-"+e),10)};c.events.stop.bind(function(){u.get().each(function(r){l.each(function(n){s(r,"data-row").each(function(t){var e=f(r,"top");ue.remove(r,"data-initial-top"),h.trigger.adjustHeight(n,e,parseInt(t,10))}),s(r,"data-column").each(function(t){var e=f(r,"left");ue.remove(r,"data-initial-left"),h.trigger.adjustWidth(n,e,parseInt(t,10))}),zo(o,n,i,e)})})});var d=function(t,e){h.trigger.startAdjust(),u.assign(t),ue.set(t,"data-initial-"+e,parseInt(Ue.get(t,e),10)),Po(t,tu),Ue.set(t,"opacity","0.2"),c.go(o.parent())},m=Ja(o.parent(),"mousedown",function(t){Uo(t.target())&&d(t.target(),"top"),Go(t.target())&&d(t.target(),"left")}),g=function(t){return Ht.eq(t,o.view())},p=Ja(o.view(),"mouseover",function(t){"table"===ne.name(t.target())||Qa(t.target(),"table",g)?(l="table"===ne.name(t.target())?W.some(t.target()):Se.ancestor(t.target(),"table",g)).each(function(t){zo(o,t,i,e)}):se.inBody(t.target())&&Vo(o)}),h=_a.create({adjustHeight:za(["table","delta","row"]),adjustWidth:za(["table","delta","column"]),startAdjust:za([])});return{destroy:function(){m.unbind(),p.unbind(),c.destroy(),Vo(o)},refresh:function(t){zo(o,t,i,e)},on:c.on,off:c.off,hideBars:M.curry(_o,o),showBars:M.curry(Fo,o),events:h.registry}}(t,m,n),g=_a.create({beforeResize:za(["table"]),afterResize:za(["table"]),startDrag:za([])});return e.events.adjustHeight.bind(function(t){g.trigger.beforeResize(t.table());var e=n.delta(t.delta(),t.table());Mi(t.table(),e,t.row(),n),g.trigger.afterResize(t.table())}),e.events.startAdjust.bind(function(t){g.trigger.startDrag()}),e.events.adjustWidth.bind(function(t){g.trigger.beforeResize(t.table());var e,n,r,o,i,a,u,c,l,s,f,d=m.delta(t.delta(),t.table());e=t.table(),n=d,r=t.column(),o=m,i=Pi(e),a=i.getCellDelta(n),u=Ei(e),c=i.getWidths(u,o,i),l=wi(c,r,a,i),s=q.map(l,function(t,e){return t+c[e]}),f=Oi(u,s),q.each(f,function(t){i.setElementWidth(t.element(),t.width())}),r===u.grid().columns()-1&&i.setTableWidth(e,s,a),g.trigger.afterResize(t.table())}),{on:e.on,off:e.off,hideBars:e.hideBars,showBars:e.showBars,destroy:e.destroy,events:g.registry}}var nu=function(t,e){return t.inline?(n=Gi(t),r=Q.fromTag("div"),Ue.setAll(r,{position:"static",height:"0",width:"0",padding:"0",margin:"0",border:"0"}),Je.append(se.body(),r),{parent:M.constant(r),view:M.constant(n),origin:M.constant(wr(0,0))}):La(Q.fromDom(t.getDoc()));var n,r},ru=function(a){var u,c,o=W.none(),i=W.none(),l=W.none(),s=/(\d+(\.\d+)?)%/,f=function(t){return"TABLE"===t.nodeName};return a.on("init",function(){var t,e=Mr(na),n=nu(a);if(l=W.some(n),("table"===(t=a.getParam("object_resizing",!0))||t)&&a.getParam("table_resize_bars",!0,"boolean")){var r=eu(n,e);r.on(),r.events.startDrag.bind(function(t){o=W.some(a.selection.getRng())}),r.events.beforeResize.bind(function(t){var e=t.table().dom();ha(a,e,Yi(e),Ji(e))}),r.events.afterResize.bind(function(t){var e=t.table(),n=e.dom();Zi(e),o.each(function(t){a.selection.setRng(t),a.focus()}),va(a,n,Yi(n),Ji(n)),a.undoManager.add()}),i=W.some(r)}}),a.on("ObjectResizeStart",function(t){var e,n=t.target;f(n)&&(u=t.width,e=n,c=a.dom.getStyle(e,"width")||a.dom.getAttrib(e,"width"))}),a.on("ObjectResized",function(t){var e=t.target;if(f(e)){var n=e;if(s.test(c)){var r=parseFloat(s.exec(c)[1]),o=t.width*r/u;a.dom.setStyle(n,"width",o+"%")}else{var i=[];wa.each(n.rows,function(t){wa.each(t.cells,function(t){var e=a.dom.getStyle(t,"width",!0);i.push({cell:t,width:e})})}),wa.each(i,function(t){a.dom.setStyle(t.cell,"width",t.width),a.dom.setAttrib(t.cell,"width",null)})}}}),{lazyResize:function(){return i},lazyWire:function(){return l.getOr(La(Q.fromDom(a.getBody())))},destroy:function(){i.each(function(t){t.destroy()}),l.each(function(t){var e;e=t,a.inline&&Ze.remove(e.parent())})}}},ou=function(t){return{fold:t}},iu=function(o){return ou(function(t,e,n,r){return t(o)})},au=function(o,i){return ou(function(t,e,n,r){return n(o,i)})},uu=function(n,t){return Ne(n,t).bind(function(t){var e=Ae(t);return q.findIndex(e,function(t){return Ht.eq(n,t)}).map(function(t){return{index:M.constant(t),all:M.constant(e)}})})},cu=function(e,t){return uu(e,t).fold(function(){return iu(e)},function(t){return t.index()+1<t.all().length?au(e,t.all()[t.index()+1]):(o=e,ou(function(t,e,n,r){return r(o)}));var o})},lu=function(e,t){return uu(e,t).fold(function(){return iu()},function(t){return 0<=t.index()-1?au(e,t.all()[t.index()-1]):(o=e,ou(function(t,e,n,r){return e(o)}));var o})},su=Gn([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),fu={before:su.before,on:su.on,after:su.after,cata:function(t,e,n,r){return t.fold(e,n,r)},getStart:function(t){return t.fold(M.identity,M.identity,M.identity)}},du=Gn([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),mu=V.immutable("start","soffset","finish","foffset"),gu={domRange:du.domRange,relative:du.relative,exact:du.exact,exactFromRange:function(t){return du.exact(t.start(),t.soffset(),t.finish(),t.foffset())},range:mu,getWin:function(t){var e=t.match({domRange:function(t){return Q.fromDom(t.startContainer)},relative:function(t,e){return fu.getStart(t)},exact:function(t,e,n,r){return t}});return Yt.defaultView(e)}},pu=function(t,e,n,r){var o,i,a,u,c,l=(i=e,a=n,u=r,(c=Yt.owner(o=t).dom().createRange()).setStart(o.dom(),i),c.setEnd(a.dom(),u),c),s=Ht.eq(t,n)&&e===r;return l.collapsed&&!s},hu=function(t,e){t.selectNodeContents(e.dom())},vu=function(t){return{left:M.constant(t.left),top:M.constant(t.top),right:M.constant(t.right),bottom:M.constant(t.bottom),width:M.constant(t.width),height:M.constant(t.height)}},bu=function(t,e){var n=t.document.createRange();return hu(n,e),n},wu=function(t,e,n){var r,o,i=t.document.createRange();return r=i,e.fold(function(t){r.setStartBefore(t.dom())},function(t,e){r.setStart(t.dom(),e)},function(t){r.setStartAfter(t.dom())}),o=i,n.fold(function(t){o.setEndBefore(t.dom())},function(t,e){o.setEnd(t.dom(),e)},function(t){o.setEndAfter(t.dom())}),i},yu=function(t,e,n,r,o){var i=t.document.createRange();return i.setStart(e.dom(),n),i.setEnd(r.dom(),o),i},xu=function(t){var e=t.getClientRects(),n=0<e.length?e[0]:t.getBoundingClientRect();return 0<n.width||0<n.height?W.some(n).map(vu):W.none()},Cu=Gn([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),Ru=function(t,e,n){return e(Q.fromDom(n.startContainer),n.startOffset,Q.fromDom(n.endContainer),n.endOffset)},Su=function(t,e){var o,n,r,i=(o=t,e.match({domRange:function(t){return{ltr:M.constant(t),rtl:W.none}},relative:function(t,e){return{ltr:at(function(){return wu(o,t,e)}),rtl:at(function(){return W.some(wu(o,e,t))})}},exact:function(t,e,n,r){return{ltr:at(function(){return yu(o,t,e,n,r)}),rtl:at(function(){return W.some(yu(o,n,r,t,e))})}}}));return(r=(n=i).ltr()).collapsed?n.rtl().filter(function(t){return!1===t.collapsed}).map(function(t){return Cu.rtl(Q.fromDom(t.endContainer),t.endOffset,Q.fromDom(t.startContainer),t.startOffset)}).getOrThunk(function(){return Ru(0,Cu.ltr,r)}):Ru(0,Cu.ltr,r)},Tu=(Cu.ltr,Cu.rtl,Su),Du=function(i,t){return Su(i,t).match({ltr:function(t,e,n,r){var o=i.document.createRange();return o.setStart(t.dom(),e),o.setEnd(n.dom(),r),o},rtl:function(t,e,n,r){var o=i.document.createRange();return o.setStart(n.dom(),r),o.setEnd(t.dom(),e),o}})},ku=function(t,e,n){return e>=t.left&&e<=t.right&&n>=t.top&&n<=t.bottom},Au=function(l,s,f,d){var t=l.dom().createRange();t.selectNode(s.dom());var e=t.getClientRects();return io(e,function(t){return ku(t,f,d)?W.some(t):W.none()}).map(function(t){return n=l,e=f,o=d,i=t,a=function(t){var e=n.dom().createRange();return e.setStart(r.dom(),t),e.collapse(!0),e},u=an.get(r=s).length,c=function(t,e,n,r,o){if(0===o)return 0;if(e===r)return o-1;for(var i=r,a=1;a<o;a++){var u=t(a),c=Math.abs(e-u.left);if(n>u.bottom);else{if(n<u.top||i<c)return a-1;i=c}}return 0}(function(t){return a(t).getBoundingClientRect()},e,o,i.right,u),a(c);var n,r,e,o,i,a,u,c})},Nu=function(t,e,n,r){return(ne.isText(e)?Au:function(e,t,n,r){var o=e.dom().createRange(),i=Yt.children(t);return io(i,function(t){return o.selectNode(t.dom()),ku(o.getBoundingClientRect(),n,r)?Nu(e,t,n,r):W.none()})})(t,e,n,r)},Ou=function(t,e){return e-t.left<t.right-e},Iu=function(t,e,n){var r=t.dom().createRange();return r.selectNode(e.dom()),r.collapse(n),r},Pu=function(t,e,n){return(0===Yt.children(e).length?function(t,e,n){var r=e.dom().getBoundingClientRect(),o=Ou(r,n);return W.some(Iu(t,e,o))}:function(e,t,n){var r=e.dom().createRange();r.selectNode(t.dom());var o=r.getBoundingClientRect(),i=Ou(o,n);return(!0===i?sn:fn)(t).map(function(t){return Iu(e,t,i)})})(t,e,n)},Bu=document.caretPositionFromPoint?function(n,t,e){return W.from(n.dom().caretPositionFromPoint(t,e)).bind(function(t){if(null===t.offsetNode)return W.none();var e=n.dom().createRange();return e.setStart(t.offsetNode,t.offset),e.collapse(),W.some(e)})}:document.caretRangeFromPoint?function(t,e,n){return W.from(t.dom().caretRangeFromPoint(e,n))}:function(n,r,o){return Q.fromPoint(n,r,o).bind(function(t){var e=function(){return Pu(n,t,r)};return 0===Yt.children(t).length?e():function(t,e,n,r){var o=t.dom().createRange();o.selectNode(e.dom());var i=o.getBoundingClientRect();return function(t,e,n,r){var o=t.dom().createRange();o.selectNode(e.dom());var i=o.getBoundingClientRect(),a=Math.max(i.left,Math.min(i.right,n)),u=Math.max(i.top,Math.min(i.bottom,r));return Nu(t,e,a,u)}(t,e,Math.max(i.left,Math.min(i.right,n)),Math.max(i.top,Math.min(i.bottom,r)))}(n,t,r,o).orThunk(e)})},Eu=function(t,e){var n=ne.name(t);return"input"===n?fu.after(t):q.contains(["br","img"],n)?0===e?fu.before(t):fu.after(t):fu.on(t,e)},Mu=function(t,e){var n=t.fold(fu.before,Eu,fu.after),r=e.fold(fu.before,Eu,fu.after);return gu.relative(n,r)},Wu=function(t,e,n,r){var o=Eu(t,e),i=Eu(n,r);return gu.relative(o,i)},ju=Mu,qu=Wu,Hu=function(t,e){W.from(t.getSelection()).each(function(t){t.removeAllRanges(),t.addRange(e)})},Lu=function(t,e,n,r,o){var i=yu(t,e,n,r,o);Hu(t,i)},zu=function(i,t){return Tu(i,t).match({ltr:function(t,e,n,r){Lu(i,t,e,n,r)},rtl:function(t,e,n,r){var o=i.getSelection();o.setBaseAndExtent?o.setBaseAndExtent(t.dom(),e,n.dom(),r):o.extend?(o.collapse(t.dom(),e),o.extend(n.dom(),r)):Lu(i,n,r,t,e)}})},_u=function(t){var e=Q.fromDom(t.anchorNode),n=Q.fromDom(t.focusNode);return pu(e,t.anchorOffset,n,t.focusOffset)?W.some(gu.range(Q.fromDom(t.anchorNode),t.anchorOffset,Q.fromDom(t.focusNode),t.focusOffset)):function(t){if(0<t.rangeCount){var e=t.getRangeAt(0),n=t.getRangeAt(t.rangeCount-1);return W.some(gu.range(Q.fromDom(e.startContainer),e.startOffset,Q.fromDom(n.endContainer),n.endOffset))}return W.none()}(t)},Fu=function(t){return(e=t,W.from(e.getSelection()).filter(function(t){return 0<t.rangeCount}).bind(_u)).map(function(t){return gu.exact(t.start(),t.soffset(),t.finish(),t.foffset())});var e},Vu=function(t){var o=gu.getWin(t).dom(),e=function(t,e,n,r){return yu(o,t,e,n,r)},n=t.match({domRange:function(t){var e=Q.fromDom(t.startContainer),n=Q.fromDom(t.endContainer);return Wu(e,t.startOffset,n,t.endOffset)},relative:Mu,exact:Wu});return Tu(o,n).match({ltr:e,rtl:e})},Uu=function(t,e,n){return r=e,o=n,i=Q.fromDom(t.document),Bu(i,r,o).map(function(t){return gu.range(Q.fromDom(t.startContainer),t.startOffset,Q.fromDom(t.endContainer),t.endOffset)});var r,o,i},Gu=tinymce.util.Tools.resolve("tinymce.util.VK"),Yu=function(t,e){var n=gu.exact(e,0,e,0);return Vu(n)},Ju=function(o,t,e,i,n){return e.fold(W.none,W.none,function(t,e){return sn(e).map(function(t){return Yu(0,t)})},function(r){return Ne(r,t).bind(function(t){var e,n=Qn.noMenu(r);return o.undoManager.transact(function(){i.insertRowsAfter(t,n)}),e=me.descendants(t,"tr"),q.last(e).bind(function(t){return Se.descendant(t,"td,th").map(function(t){return Yu(0,t)})})})})},Xu=["table","li","dl"],Ku=function(e,n,r,o){if(e.keyCode===Gu.TAB){var i=Gi(n),a=function(t){var e=ne.name(t);return Ht.eq(t,i)||q.contains(Xu,e)},t=n.selection.getRng();if(t.collapsed){var u=Q.fromDom(t.startContainer);ke(u,a).each(function(t){e.preventDefault(),(e.shiftKey?function(t,e,n,r){return Ju(t,e,lu(n),r)}:function(t,e,n,r){return Ju(t,e,cu(n),r)})(n,a,t,r,o).each(function(t){n.selection.setRng(t)})})}}},Zu={response:V.immutable("selection","kill")},$u=function(e){return function(t){return t===e}},Qu=$u(38),tc=$u(40),ec={ltr:{isBackward:$u(37),isForward:$u(39)},rtl:{isBackward:$u(39),isForward:$u(37)},isUp:Qu,isDown:tc,isNavigation:function(t){return 37<=t&&t<=40}},nc=function(t,e){var n=Du(t,e);return{start:M.constant(Q.fromDom(n.startContainer)),soffset:M.constant(n.startOffset),finish:M.constant(Q.fromDom(n.endContainer)),foffset:M.constant(n.endOffset)}},rc=function(t,e,n,r){return{start:M.constant(fu.on(t,e)),finish:M.constant(fu.on(n,r))}},oc=(Wt.detect().browser.isSafari(),function(t){var e=void 0!==t?t.dom():document,n=e.body.scrollLeft||e.documentElement.scrollLeft,r=e.body.scrollTop||e.documentElement.scrollTop;return wr(n,r)});function ic(c){return{elementFromPoint:function(t,e){return Q.fromPoint(Q.fromDom(c.document),t,e)},getRect:function(t){return t.dom().getBoundingClientRect()},getRangedRect:function(t,e,n,r){var o,i,a,u=gu.exact(t,e,n,r);return(o=c,i=u,a=Du(o,i),xu(a)).map(function(t){return E.map(t,M.apply)})},getSelection:function(){return Fu(c).map(function(t){return nc(c,t)})},fromSitus:function(t){var e=gu.relative(t.start(),t.finish());return nc(c,e)},situsFromPoint:function(t,e){return Uu(c,t,e).map(function(t){return{start:M.constant(fu.on(t.start(),t.soffset())),finish:M.constant(fu.on(t.finish(),t.foffset()))}})},clearSelection:function(){c.getSelection().removeAllRanges()},setSelection:function(t){var e,n,r,o,i,a;e=c,n=t.start(),r=t.soffset(),o=t.finish(),i=t.foffset(),a=qu(n,r,o,i),zu(e,a)},setRelativeSelection:function(t,e){var n,r;n=c,r=ju(t,e),zu(n,r)},selectContents:function(t){var e,n;n=bu(e=c,t),Hu(e,n)},getInnerHeight:function(){return c.innerHeight},getScrollY:function(){return oc(Q.fromDom(c.document)).top()},scrollBy:function(t,e){var n,r,o;n=t,r=e,(void 0!==(o=Q.fromDom(c.document))?o.dom():document).defaultView.scrollBy(n,r)}}}var ac=function(n,t,r,e,o){return Ht.eq(r,e)?W.none():zn(r,e,t).bind(function(t){var e=t.boxes().getOr([]);return 0<e.length?(o(n,e,t.start(),t.finish()),W.some(Zu.response(W.some(rc(r,0,r,cn(r))),!0))):W.none()})},uc=function(n,r,t,e,o,i,a){return Ht.eq(t,o)&&e===i?W.none():Se.closest(t,"td,th",r).bind(function(e){return Se.closest(o,"td,th",r).bind(function(t){return ac(n,r,e,t,a)})})},cc=ac,lc=function(t,e,n,r,o){return(i=r,a=t,u=e,c=o.firstSelectedSelector(),l=o.lastSelectedSelector(),(s=i,f=l,q.find(s,function(t){return et.is(t,f)})).bind(function(t){return Wn(t,a,u).bind(function(t){return n=c,Se.ancestor(e=t,"table").bind(function(t){return Se.descendant(t,n).bind(function(t){return Ln(t,e).bind(function(e){return e.boxes().map(function(t){return{boxes:M.constant(t),start:M.constant(e.start()),finish:M.constant(e.finish())}})})})});var e,n})})).map(function(t){return o.clear(n),o.selectRange(n,t.boxes(),t.start(),t.finish()),t.boxes()});var i,a,u,c,l,s,f},sc=V.immutableBag(["left","top","right","bottom"],[]),fc={nu:sc,moveUp:function(t,e){return sc({left:t.left(),top:t.top()-e,right:t.right(),bottom:t.bottom()-e})},moveDown:function(t,e){return sc({left:t.left(),top:t.top()+e,right:t.right(),bottom:t.bottom()+e})},moveBottomTo:function(t,e){var n=t.bottom()-t.top();return sc({left:t.left(),top:e-n,right:t.right(),bottom:e})},moveTopTo:function(t,e){var n=t.bottom()-t.top();return sc({left:t.left(),top:e,right:t.right(),bottom:e+n})},getTop:function(t){return t.top()},getBottom:function(t){return t.bottom()},translate:function(t,e,n){return sc({left:t.left()+e,top:t.top()+n,right:t.right()+e,bottom:t.bottom()+n})},toString:function(t){return"("+t.left()+", "+t.top()+") -> ("+t.right()+", "+t.bottom()+")"}},dc=function(t){return fc.nu({left:t.left,top:t.top,right:t.right,bottom:t.bottom})},mc=function(t,e){return W.some(t.getRect(e))},gc=function(t,e,n){return ne.isElement(e)?mc(t,e).map(dc):ne.isText(e)?(r=t,o=e,i=n,0<=i&&i<cn(o)?r.getRangedRect(o,i,o,i+1):0<i?r.getRangedRect(o,i-1,o,i):W.none()).map(dc):W.none();var r,o,i},pc=function(t,e){return ne.isElement(e)?mc(t,e).map(dc):ne.isText(e)?t.getRangedRect(e,0,e,cn(e)).map(dc):W.none()},hc=V.immutable("item","mode"),vc=function(t,e,n,r){var o=void 0!==r?r:bc;return t.property().parent(e).map(function(t){return hc(t,o)})},bc=function(t,e,n,r){var o=void 0!==r?r:wc;return n.sibling(t,e).map(function(t){return hc(t,o)})},wc=function(t,e,n,r){var o=void 0!==r?r:wc,i=t.property().children(e);return n.first(i).map(function(t){return hc(t,o)})},yc=[{current:vc,next:bc,fallback:W.none()},{current:bc,next:wc,fallback:W.some(vc)},{current:wc,next:wc,fallback:W.some(bc)}],xc=function(e,n,r,o,t){return t=void 0!==t?t:yc,q.find(t,function(t){return t.current===r}).bind(function(t){return t.current(e,n,o,t.next).orThunk(function(){return t.fallback.bind(function(t){return xc(e,n,t,o)})})})},Cc={backtrack:vc,sidestep:bc,advance:wc,go:xc},Rc={left:function(){return{sibling:function(t,e){return t.query().prevSibling(e)},first:function(t){return 0<t.length?W.some(t[t.length-1]):W.none()}}},right:function(){return{sibling:function(t,e){return t.query().nextSibling(e)},first:function(t){return 0<t.length?W.some(t[0]):W.none()}}}},Sc=function(e,t,n,r,o,i){return Cc.go(e,t,r,o).bind(function(t){return i(t.item())?W.none():n(t.item())?W.some(t.item()):Sc(e,t.item(),n,t.mode(),o,i)})},Tc=function(t,e){return 0===t.property().children(e).length},Dc=function(t,e,n,r){return o=r,Sc(t,e,n,Cc.sidestep,Rc.left(),o);var o},kc=function(t,e,n,r){return o=r,Sc(t,e,n,Cc.sidestep,Rc.right(),o);var o},Ac={before:function(t,e,n){return Dc(t,e,M.curry(Tc,t),n)},after:function(t,e,n){return kc(t,e,M.curry(Tc,t),n)},seekLeft:Dc,seekRight:kc,walkers:function(){return{left:Rc.left,right:Rc.right}},walk:function(t,e,n,r,o){return Cc.go(t,e,n,r,o)},backtrack:Cc.backtrack,sidestep:Cc.sidestep,advance:Cc.advance},Nc=wn(),Oc={gather:function(t,e,n){return Ac.gather(Nc,t,e,n)},before:function(t,e){return Ac.before(Nc,t,e)},after:function(t,e){return Ac.after(Nc,t,e)},seekLeft:function(t,e,n){return Ac.seekLeft(Nc,t,e,n)},seekRight:function(t,e,n){return Ac.seekRight(Nc,t,e,n)},walkers:function(){return Ac.walkers()},walk:function(t,e,n,r){return Ac.walk(Nc,t,e,n,r)}},Ic=Gn([{none:[]},{retry:["caret"]}]),Pc=function(e,t,r){return Ce.closest(t,Zr).fold(M.constant(!1),function(t){return pc(e,t).exists(function(t){return n=t,(e=r).left()<n.left()||Math.abs(n.right()-e.left())<1||e.left()>n.right();var e,n})})},Bc={point:fc.getTop,adjuster:function(t,e,n,r,o){var i=fc.moveUp(o,5);return Math.abs(n.top()-r.top())<1?Ic.retry(i):n.bottom()<o.top()?Ic.retry(i):n.bottom()===o.top()?Ic.retry(fc.moveUp(o,1)):Pc(t,e,o)?Ic.retry(fc.translate(i,5,0)):Ic.none()},move:fc.moveUp,gather:Oc.before},Ec={point:fc.getBottom,adjuster:function(t,e,n,r,o){var i=fc.moveDown(o,5);return Math.abs(n.bottom()-r.bottom())<1?Ic.retry(i):n.top()>o.bottom()?Ic.retry(i):n.top()===o.bottom()?Ic.retry(fc.moveDown(o,1)):Pc(t,e,o)?Ic.retry(fc.translate(i,5,0)):Ic.none()},move:fc.moveDown,gather:Oc.after},Mc=function(n,r,o,i,a){return 0===a?W.some(i):(c=n,l=i.left(),s=r.point(i),c.elementFromPoint(l,s).filter(function(t){return"table"===ne.name(t)}).isSome()?(e=i,u=a-1,Mc(n,t=r,o,t.move(e,5),u)):n.situsFromPoint(i.left(),r.point(i)).bind(function(t){return t.start().fold(W.none,function(e,t){return pc(n,e).bind(function(t){return r.adjuster(n,e,t,o,i).fold(W.none,function(t){return Mc(n,r,o,t,a-1)})}).orThunk(function(){return W.some(i)})},W.none)}));var t,e,u,c,l,s},Wc=function(e,n,t){var r,o,i,a=e.move(t,5),u=Mc(n,e,t,a,100).getOr(a);return(r=e,o=u,i=n,r.point(o)>i.getInnerHeight()?W.some(r.point(o)-i.getInnerHeight()):r.point(o)<0?W.some(-r.point(o)):W.none()).fold(function(){return n.situsFromPoint(u.left(),e.point(u))},function(t){return n.scrollBy(0,t),n.situsFromPoint(u.left(),e.point(u)-t)})},jc={tryUp:M.curry(Wc,Bc),tryDown:M.curry(Wc,Ec),ieTryUp:function(t,e){return t.situsFromPoint(e.left(),e.top()-5)},ieTryDown:function(t,e){return t.situsFromPoint(e.left(),e.bottom()+5)},getJumpSize:M.constant(5)},qc=Gn([{none:["message"]},{success:[]},{failedUp:["cell"]},{failedDown:["cell"]}]),Hc=function(t){return Se.closest(t,"tr")},Lc={verify:function(u,t,e,n,r,c,o){return Se.closest(n,"td,th",o).bind(function(a){return Se.closest(t,"td,th",o).map(function(i){return Ht.eq(a,i)?Ht.eq(n,a)&&cn(a)===r?c(i):qc.none("in same cell"):Dn(Hc,[a,i]).fold(function(){return e=i,n=a,r=(t=u).getRect(e),(o=t.getRect(n)).right>r.left&&o.left<r.right?qc.success():c(i);var t,e,n,r,o},function(t){return c(i)})})}).getOr(qc.none("default"))},cata:function(t,e,n,r,o){return t.fold(e,n,r,o)},adt:qc},zc={point:V.immutable("element","offset"),delta:V.immutable("element","deltaOffset"),range:V.immutable("element","start","finish"),points:V.immutable("begin","end"),text:V.immutable("element","text")},_c=(V.immutable("ancestor","descendants","element","index"),V.immutable("parent","children","element","index")),Fc=function(o){return Yt.parent(o).bind(function(e){var t,n,r=Yt.children(e);return(t=r,n=o,q.findIndex(t,M.curry(Ht.eq,n))).map(function(t){return _c(e,r,o,t)})})},Vc=function(t){return"br"===ne.name(t)},Uc=function(t,e,n){return e(t,n).bind(function(t){return ne.isText(t)&&0===an.get(t).trim().length?Uc(t,e,n):W.some(t)})},Gc=function(t,e,n,r){var o,i,a,u,c,l,s,f,d;return(Vc(e)?(o=t,i=e,(a=r).traverse(i).orThunk(function(){return Uc(i,a.gather,o)}).map(a.relative)):(u=t,c=e,l=n,s=r,(f=c,d=l,Yt.child(f,d).filter(Vc).orThunk(function(){return Yt.child(f,d-1).filter(Vc)})).bind(function(t){return s.traverse(t).fold(function(){return Uc(t,s.gather,u).map(s.relative)},function(t){return Fc(t).map(function(t){return fu.on(t.parent(),t.index())})})}))).map(function(t){return{start:M.constant(t),finish:M.constant(t)}})},Yc=Wt.detect(),Jc=function(r,o,i,a,u,c){return 0===c?W.none():Zc(r,o,i,a,u).bind(function(t){var e=r.fromSitus(t),n=Lc.verify(r,i,a,e.finish(),e.foffset(),u.failure,o);return Lc.cata(n,function(){return W.none()},function(){return W.some(t)},function(t){return Ht.eq(i,t)&&0===a?Xc(r,i,a,fc.moveUp,u):Jc(r,o,t,0,u,c-1)},function(t){return Ht.eq(i,t)&&a===cn(t)?Xc(r,i,a,fc.moveDown,u):Jc(r,o,t,cn(t),u,c-1)})})},Xc=function(e,t,n,r,o){return gc(e,t,n).bind(function(t){return Kc(e,o,r(t,jc.getJumpSize()))})},Kc=function(t,e,n){return Yc.browser.isChrome()||Yc.browser.isSafari()||Yc.browser.isFirefox()||Yc.browser.isEdge()?e.otherRetry(t,n):Yc.browser.isIE()?e.ieRetry(t,n):W.none()},Zc=function(e,t,n,r,o){return gc(e,n,r).bind(function(t){return Kc(e,o,t)})},$c=function(e,n,r){return(o=e,i=n,a=r,o.getSelection().bind(function(r){return Gc(i,r.finish(),r.foffset(),a).fold(function(){return W.some(zc.point(r.finish(),r.foffset()))},function(t){var e=o.fromSitus(t),n=Lc.verify(o,r.finish(),r.foffset(),e.finish(),e.foffset(),a.failure,i);return Lc.cata(n,function(t){return W.none()},function(){return W.none()},function(t){return W.some(zc.point(t,0))},function(t){return W.some(zc.point(t,cn(t)))})})})).bind(function(t){return Jc(e,n,t.element(),t.offset(),r,20).map(e.fromSitus)});var o,i,a},Qc=Wt.detect(),tl=function(o,i,a,t,u){return Se.closest(t,"td,th",i).bind(function(r){return Se.closest(r,"table",i).bind(function(t){return n=t,Ce.ancestor(u,function(t){return Yt.parent(t).exists(function(t){return Ht.eq(t,n)})},e).isSome()?$c(o,i,a).bind(function(e){return Se.closest(e.finish(),"td,th",i).map(function(t){return{start:M.constant(r),finish:M.constant(t),range:M.constant(e)}})}):W.none();var e,n})})},el=function(t,e,n,r,o,i){return Qc.browser.isIE()?W.none():i(r,e).orThunk(function(){return tl(t,e,n,r,o).map(function(t){var e=t.range();return Zu.response(W.some(rc(e.start(),e.soffset(),e.finish(),e.foffset())),!0)})})},nl=function(t,e,n,r,o,i,a){return tl(t,n,r,o,i).bind(function(t){return cc(e,n,t.start(),t.finish(),a)})},rl=function(t,r){return Se.closest(t,"tr",r).bind(function(n){return Se.closest(n,"table",r).bind(function(t){var e=me.descendants(t,"tr");return Ht.eq(n,e[0])?Oc.seekLeft(t,function(t){return fn(t).isSome()},r).map(function(t){var e=cn(t);return Zu.response(W.some(rc(t,e,t,e)),!0)}):W.none()})})},ol=function(t,r){return Se.closest(t,"tr",r).bind(function(n){return Se.closest(n,"table",r).bind(function(t){var e=me.descendants(t,"tr");return Ht.eq(n,e[e.length-1])?Oc.seekRight(t,function(t){return sn(t).isSome()},r).map(function(t){return Zu.response(W.some(rc(t,0,t,0)),!0)}):W.none()})})},il=function(t,e){return Se.closest(t,"td,th",e)},al={down:{traverse:Yt.nextSibling,gather:Oc.after,relative:fu.before,otherRetry:jc.tryDown,ieRetry:jc.ieTryDown,failure:Lc.adt.failedDown},up:{traverse:Yt.prevSibling,gather:Oc.before,relative:fu.before,otherRetry:jc.tryUp,ieRetry:jc.ieTryUp,failure:Lc.adt.failedUp}},ul=V.immutable("rows","cols"),cl=function(t,e,n,r){var o,i,a,u,c,l,s=ic(t),f=(o=s,i=e,a=n,u=r,c=W.none(),l=function(){c=W.none()},{mousedown:function(t){u.clear(i),c=il(t.target(),a)},mouseover:function(t){c.each(function(r){u.clear(i),il(t.target(),a).each(function(n){zn(r,n,a).each(function(t){var e=t.boxes().getOr([]);(1<e.length||1===e.length&&!Ht.eq(r,n))&&(u.selectRange(i,e,t.start(),t.finish()),o.selectContents(n))})})})},mouseup:function(){c.each(l)}});return{mousedown:f.mousedown,mouseover:f.mouseover,mouseup:f.mouseup}},ll=function(t,c,l,s){var f=ic(t),d=function(){return s.clear(c),W.none()};return{keydown:function(t,e,n,r,o,i){var a=t.raw().which,u=!0===t.raw().shiftKey;return _n(c,s.selectedSelector()).fold(function(){return ec.isDown(a)&&u?M.curry(nl,f,c,l,al.down,r,e,s.selectRange):ec.isUp(a)&&u?M.curry(nl,f,c,l,al.up,r,e,s.selectRange):ec.isDown(a)?M.curry(el,f,l,al.down,r,e,ol):ec.isUp(a)?M.curry(el,f,l,al.up,r,e,rl):W.none},function(e){var t=function(t){return function(){return io(t,function(t){return lc(t.rows(),t.cols(),c,e,s)}).fold(function(){return Fn(c,s.firstSelectedSelector(),s.lastSelectedSelector()).map(function(t){var e=ec.isDown(a)||i.isForward(a)?fu.after:fu.before;return f.setRelativeSelection(fu.on(t.first(),0),e(t.table())),s.clear(c),Zu.response(W.none(),!0)})},function(t){return W.some(Zu.response(W.none(),!0))})}};return ec.isDown(a)&&u?t([ul(1,0)]):ec.isUp(a)&&u?t([ul(-1,0)]):i.isBackward(a)&&u?t([ul(0,-1),ul(-1,0)]):i.isForward(a)&&u?t([ul(0,1),ul(1,0)]):ec.isNavigation(a)&&!1===u?d:W.none})()},keyup:function(e,n,r,o,i){return _n(c,s.selectedSelector()).fold(function(){var t=e.raw().which;return 0==(!0===e.raw().shiftKey)?W.none():ec.isNavigation(t)?uc(c,l,n,r,o,i,s.selectRange):W.none()},W.none)}}},sl=function(o){var n=function(t){ue.remove(t,o.selected()),ue.remove(t,o.firstSelected()),ue.remove(t,o.lastSelected())},i=function(t){ue.set(t,o.selected(),"1")},a=function(t){var e=me.descendants(t,o.selectedSelector());q.each(e,n)};return{clear:a,selectRange:function(t,e,n,r){a(t),q.each(e,i),ue.set(n,o.firstSelected(),"1"),ue.set(r,o.lastSelected(),"1")},selectedSelector:o.selectedSelector,firstSelectedSelector:o.firstSelectedSelector,lastSelectedSelector:o.lastSelectedSelector}},fl=function(t){return!1===Bo(Q.fromDom(t.target),"ephox-snooker-resizer-bar")};var dl=wa.each;a.add("table",function(e){var r,s,t,n,o,f,i,p,h,v,b,w,a,u,c,l,d,m,g,y,x,C,R,S,T,D,k,A,N,O=ru(e),I=(p=e,h=O.lazyResize,v=V.immutableBag(["mousedown","mouseover","mouseup","keyup","keydown"],[]),b=W.none(),w=sl(Un),p.on("init",function(t){var r=p.getWin(),o=Gi(p),e=Xi(p),n=cl(r,o,e,w),u=ll(r,o,e,w),c=function(t,e){!0===t.raw().shiftKey&&(e.kill()&&t.kill(),e.selection().each(function(t){var e=gu.relative(t.start(),t.finish()),n=Du(r,e);p.selection.setRng(n)}))},i=function(t){var e=s(t);if(e.raw().shiftKey&&ec.isNavigation(e.raw().which)){var n=p.selection.getRng(),r=Q.fromDom(n.startContainer),o=Q.fromDom(n.endContainer);u.keyup(e,r,n.startOffset,o,n.endOffset).each(function(t){c(e,t)})}},a=function(t){var e=s(t);h().each(function(t){t.hideBars()});var n=p.selection.getRng(),r=Q.fromDom(p.selection.getStart()),o=Q.fromDom(n.startContainer),i=Q.fromDom(n.endContainer),a=na(r).isRtl()?ec.rtl:ec.ltr;u.keydown(e,o,n.startOffset,i,n.endOffset,a).each(function(t){c(e,t)}),h().each(function(t){t.showBars()})},l=function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")},s=function(t){var e=Q.fromDom(t.target),n=function(){t.stopPropagation()},r=function(){t.preventDefault()},o=M.compose(r,n);return{target:M.constant(e),x:M.constant(l(t)?t.x:null),y:M.constant(l(t)?t.y:null),stop:n,prevent:r,kill:o,raw:M.constant(t)}},f=function(t){return 0===t.button},d=function(t){f(t)&&fl(t)&&n.mousedown(s(t))},m=function(t){var e;void 0!==(e=t).buttons&&0==(1&e.buttons)||!fl(t)||n.mouseover(s(t))},g=function(t){f(t)&&fl(t)&&n.mouseup(s(t))};p.on("mousedown",d),p.on("mouseover",m),p.on("mouseup",g),p.on("keyup",i),p.on("keydown",a),p.on("nodechange",function(){var t=p.selection,e=Q.fromDom(t.getStart()),n=Q.fromDom(t.getEnd());Dn(Ne,[e,n]).fold(function(){w.clear(o)},M.noop)}),b=W.some(v({mousedown:d,mouseover:m,mouseup:g,keyup:i,keydown:a}))}),{clear:w.clear,destroy:function(){b.each(function(t){})}}),P=(s=e,t=O.lazyWire,o=function(t){return"table"===ne.name(Gi(t))},n=s.getParam("table_clone_elements"),f=j.isString(n)?W.some(n.split(/[ ,]/)):Array.isArray(n)?W.some(n):W.none(),{deleteRow:(i=function(a,u,c,l){return function(t,e){Zi(t);var n=l(),r=Q.fromDom(s.getDoc()),o=Mr(na),i=hn(c,r,f);return u(t)?a(n,t,e,i,o).bind(function(t){return q.each(t.newRows(),function(t){ga(s,t.dom())}),q.each(t.newCells(),function(t){pa(s,t.dom())}),t.cursor().map(function(t){var e=s.dom.createRng();return e.setStart(t.dom(),0),e.setEnd(t.dom(),0),e})}):W.none()}})(Ui.eraseRows,function(t){var e=Wr(t);return!1===o(s)||1<e.rows()},M.noop,t),deleteColumn:i(Ui.eraseColumns,function(t){var e=Wr(t);return!1===o(s)||1<e.columns()},M.noop,t),insertRowsBefore:i(Ui.insertRowsBefore,M.always,M.noop,t),insertRowsAfter:i(Ui.insertRowsAfter,M.always,M.noop,t),insertColumnsBefore:i(Ui.insertColumnsBefore,M.always,br,t),insertColumnsAfter:i(Ui.insertColumnsAfter,M.always,br,t),mergeCells:i(Ui.mergeCells,M.always,M.noop,t),unmergeCells:i(Ui.unmergeCells,M.always,M.noop,t),pasteRowsBefore:i(Ui.pasteRowsBefore,M.always,M.noop,t),pasteRowsAfter:i(Ui.pasteRowsAfter,M.always,M.noop,t),pasteCells:i(Ui.pasteCells,M.always,M.noop,t)}),B=(r=e,{get:function(){var t,e,n=Gi(r);return(t=n,e=Un.selectedSelector(),_n(t,e)).fold(function(){return void 0===r.selection.getStart()?Jn.none():Jn.single(r.selection)},function(t){return Jn.multiple(t)})}}),E=jr(W.none());return g=P,y=I,x=B,C=E,R=Xi(m=e),S=function(){return Q.fromDom(m.dom.getParent(m.selection.getStart(),"th,td"))},T=function(t){return Ne(t,R)},D=function(t){return{width:Yi(t.dom()),height:Yi(t.dom())}},k=function(e){var n=S();T(n).each(function(i){var t=Qn.forMenu(x,i,n),a=D(i);e(i,t).each(function(t){var e,n,r,o;e=m,n=a,o=D(r=i),n.width===o.width&&n.height===o.height||(ha(e,r.dom(),n.width,n.height),va(e,r.dom(),o.width,o.height)),m.selection.setRng(t),m.focus(),y.clear(i),Zi(i)})})},A=function(t){var o=S();return T(o).bind(function(t){var e=Q.fromDom(m.getDoc()),n=Qn.forMenu(x,t,o),r=hn(M.noop,e,W.none());return ba(t,n,r)})},N=function(a){C.get().each(function(t){var o=q.map(t,function(t){return nn(t)}),i=S();T(i).bind(function(e){var t=Q.fromDom(m.getDoc()),n=vn(t),r=Qn.pasteRows(x,e,i,o,n);a(e,r).each(function(t){m.selection.setRng(t),m.focus(),y.clear(e)})})})},Ha({mceTableSplitCells:function(){k(g.unmergeCells)},mceTableMergeCells:function(){k(g.mergeCells)},mceTableInsertRowBefore:function(){k(g.insertRowsBefore)},mceTableInsertRowAfter:function(){k(g.insertRowsAfter)},mceTableInsertColBefore:function(){k(g.insertColumnsBefore)},mceTableInsertColAfter:function(){k(g.insertColumnsAfter)},mceTableDeleteCol:function(){k(g.deleteColumn)},mceTableDeleteRow:function(){k(g.deleteRow)},mceTableCutRow:function(t){C.set(A()),k(g.deleteRow)},mceTableCopyRow:function(t){C.set(A())},mceTablePasteRowBefore:function(t){N(g.pasteRowsBefore)},mceTablePasteRowAfter:function(t){N(g.pasteRowsAfter)},mceTableDelete:function(){var t=Q.fromDom(m.dom.getParent(m.selection.getStart(),"th,td"));Ne(t,R).filter(M.not(R)).each(function(t){var e=Q.fromText("");Je.after(t,e),Ze.remove(t);var n=m.dom.createRng();n.setStart(e.dom(),0),n.setEnd(e.dom(),0),m.selection.setRng(n)})}},function(t,e){m.addCommand(e,t)}),Ha({mceInsertTable:M.curry(qa,m),mceTableProps:M.curry(qa,m,!0),mceTableRowProps:M.curry(Ia,m),mceTableCellProps:M.curry(Na,m)},function(n,t){m.addCommand(t,function(t,e){n(e)})}),tr(e,B,P,I),function(o,n){var r=W.none(),i=[],a=[],u=[],c=[],l=function(t){t.disabled(!0)},s=function(t){t.disabled(!1)},t=function(){var e=this;i.push(e),r.fold(function(){l(e)},function(t){s(e)})},e=function(){var e=this;a.push(e),r.fold(function(){l(e)},function(t){s(e)})};o.on("init",function(){o.on("nodechange",function(t){var e=W.from(o.dom.getParent(o.selection.getStart(),"th,td"));(r=e.bind(function(t){var e=Q.fromDom(t);return Ne(e).map(function(t){return Qn.forMenu(n,t,e)})})).fold(function(){q.each(i,l),q.each(a,l),q.each(u,l),q.each(c,l)},function(e){q.each(i,s),q.each(a,s),q.each(u,function(t){t.disabled(e.mergable().isNone())}),q.each(c,function(t){t.disabled(e.unmergable().isNone())})})})});var f=function(t,e,n,r){var o,i,a,u,c,l=r.getEl().getElementsByTagName("table")[0],s=r.isRtl()||"tl-tr"===r.parent().rel;for(l.nextSibling.innerHTML=e+1+" x "+(n+1),s&&(e=9-e),i=0;i<10;i++)for(o=0;o<10;o++)u=l.rows[i].childNodes[o].firstChild,c=(s?e<=o:o<=e)&&i<=n,t.dom.toggleClass(u,"mce-active",c),c&&(a=u);return a.parentNode},d=!1===o.getParam("table_grid",!0,"boolean")?{text:"Table",icon:"table",context:"table",onclick:m("mceInsertTable")}:{text:"Table",icon:"table",context:"table",ariaHideMenu:!0,onclick:function(t){t.aria&&(this.parent().hideAll(),t.stopImmediatePropagation(),o.execCommand("mceInsertTable"))},onshow:function(){f(o,0,0,this.menu.items()[0])},onhide:function(){var t=this.menu.items()[0].getEl().getElementsByTagName("a");o.dom.removeClass(t,"mce-active"),o.dom.addClass(t[0],"mce-active")},menu:[{type:"container",html:function(){var t="";t='<table role="grid" class="mce-grid mce-grid-border" aria-readonly="true">';for(var e=0;e<10;e++){t+="<tr>";for(var n=0;n<10;n++)t+='<td role="gridcell" tabindex="-1"><a id="mcegrid'+(10*e+n)+'" href="#" data-mce-x="'+n+'" data-mce-y="'+e+'"></a></td>';t+="</tr>"}return(t+="</table>")+'<div class="mce-text-center" role="presentation">1 x 1</div>'}(),onPostRender:function(){this.lastX=this.lastY=0},onmousemove:function(t){var e,n,r=t.target;"A"===r.tagName.toUpperCase()&&(e=parseInt(r.getAttribute("data-mce-x"),10),n=parseInt(r.getAttribute("data-mce-y"),10),(this.isRtl()||"tl-tr"===this.parent().rel)&&(e=9-e),e===this.lastX&&n===this.lastY||(f(o,e,n,t.control),this.lastX=e,this.lastY=n))},onclick:function(t){var e=this;"A"===t.target.tagName.toUpperCase()&&(t.preventDefault(),t.stopPropagation(),e.parent().cancel(),o.undoManager.transact(function(){Ma(o,e.lastX+1,e.lastY+1)}),o.addVisual())}}]};function m(t){return function(){o.execCommand(t)}}var g={text:"Table properties",context:"table",onPostRender:t,onclick:m("mceTableProps")},p={text:"Delete table",context:"table",onPostRender:t,cmd:"mceTableDelete"},h={text:"Row",context:"table",menu:[{text:"Insert row before",onclick:m("mceTableInsertRowBefore"),onPostRender:e},{text:"Insert row after",onclick:m("mceTableInsertRowAfter"),onPostRender:e},{text:"Delete row",onclick:m("mceTableDeleteRow"),onPostRender:e},{text:"Row properties",onclick:m("mceTableRowProps"),onPostRender:e},{text:"-"},{text:"Cut row",onclick:m("mceTableCutRow"),onPostRender:e},{text:"Copy row",onclick:m("mceTableCopyRow"),onPostRender:e},{text:"Paste row before",onclick:m("mceTablePasteRowBefore"),onPostRender:e},{text:"Paste row after",onclick:m("mceTablePasteRowAfter"),onPostRender:e}]},v={text:"Column",context:"table",menu:[{text:"Insert column before",onclick:m("mceTableInsertColBefore"),onPostRender:e},{text:"Insert column after",onclick:m("mceTableInsertColAfter"),onPostRender:e},{text:"Delete column",onclick:m("mceTableDeleteCol"),onPostRender:e}]},b={separator:"before",text:"Cell",context:"table",menu:[{text:"Cell properties",onclick:m("mceTableCellProps"),onPostRender:e},{text:"Merge cells",onclick:m("mceTableMergeCells"),onPostRender:function(){var e=this;u.push(e),r.fold(function(){l(e)},function(t){e.disabled(t.mergable().isNone())})}},{text:"Split cell",onclick:m("mceTableSplitCells"),onPostRender:function(){var e=this;c.push(e),r.fold(function(){l(e)},function(t){e.disabled(t.unmergable().isNone())})}}]};o.addMenuItem("inserttable",d),o.addMenuItem("tableprops",g),o.addMenuItem("deletetable",p),o.addMenuItem("row",h),o.addMenuItem("column",v),o.addMenuItem("cell",b)}(e,B),function(e){var n=[];function t(t){return function(){e.execCommand(t)}}dl("inserttable tableprops deletetable | cell row column".split(" "),function(t){"|"===t?n.push({text:"-"}):n.push(e.menuItems[t])}),e.addButton("table",{type:"menubutton",title:"Table",icon:"mce-table",image:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0%0D%0APSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJu%0D%0Ab25lIi8+PHBhdGggZD0iTTIwIDJINGMtMS4xIDAtMiAuOS0yIDJ2MTZjMCAxLjEuOSAyIDIgMmgx%0D%0ANmMxLjEgMCAyLS45IDItMlY0YzAtMS4xLS45LTItMi0yek04IDIwSDR2LTRoNHY0em0wLTZINHYt%0D%0ANGg0djR6bTAtNkg0VjRoNHY0em02IDEyaC00di00aDR2NHptMC02aC00di00aDR2NHptMC02aC00%0D%0AVjRoNHY0em02IDEyaC00di00aDR2NHptMC02aC00di00aDR2NHptMC02aC00VjRoNHY0eiIvPjwv%0D%0Ac3ZnPg==",menu:n}),e.addButton("tableprops",{title:"Table properties",onclick:t("mceTableProps"),icon:"table"}),e.addButton("tabledelete",{title:"Delete table",onclick:t("mceTableDelete")}),e.addButton("tablecellprops",{title:"Cell properties",onclick:t("mceTableCellProps")}),e.addButton("tablemergecells",{title:"Merge cells",onclick:t("mceTableMergeCells")}),e.addButton("tablesplitcells",{title:"Split cell",onclick:t("mceTableSplitCells")}),e.addButton("tableinsertrowbefore",{title:"Insert row before",onclick:t("mceTableInsertRowBefore")}),e.addButton("tableinsertrowafter",{title:"Insert row after",onclick:t("mceTableInsertRowAfter")}),e.addButton("tabledeleterow",{title:"Delete row",onclick:t("mceTableDeleteRow")}),e.addButton("tablerowprops",{title:"Row properties",onclick:t("mceTableRowProps")}),e.addButton("tablecutrow",{title:"Cut row",onclick:t("mceTableCutRow")}),e.addButton("tablecopyrow",{title:"Copy row",onclick:t("mceTableCopyRow")}),e.addButton("tablepasterowbefore",{title:"Paste row before",onclick:t("mceTablePasteRowBefore")}),e.addButton("tablepasterowafter",{title:"Paste row after",onclick:t("mceTablePasteRowAfter")}),e.addButton("tableinsertcolbefore",{title:"Insert column before",onclick:t("mceTableInsertColBefore")}),e.addButton("tableinsertcolafter",{title:"Insert column after",onclick:t("mceTableInsertColAfter")}),e.addButton("tabledeletecol",{title:"Delete column",onclick:t("mceTableDeleteCol")})}(e),0<(d=""===(l=(c=e).getParam("table_toolbar",ra))||!1===l?[]:j.isString(l)?l.split(/[ ,]/):j.isArray(l)?l:[]).length&&c.addContextToolbar(function(t){return c.dom.is(t,"table")&&c.getBody().contains(t)},d.join(" ")),e.on("PreInit",function(){e.serializer.addTempAttr(Un.firstSelected()),e.serializer.addTempAttr(Un.lastSelected())}),e.getParam("table_tab_navigation",!0,"boolean")&&e.on("keydown",function(t){Ku(t,e,P,O.lazyWire)}),e.on("remove",function(){O.destroy(),I.destroy()}),a=e,u=E,{insertTable:function(t,e){return Ma(a,t,e)},setClipboardRows:function(t){return e=t,n=u,r=q.map(e,Q.fromDom),void n.set(W.from(r));var e,n,r},getClipboardRows:function(){return u.get().fold(function(){},function(t){return q.map(t,function(t){return t.dom()})})}}})}();
